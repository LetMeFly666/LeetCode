<!--
 * @Author: LetMeFly
 * @Date: 2025-05-12 23:12:13
 * @LastEditors: LetMeFly.xyz
 * @LastEditTime: 2025-05-18 15:29:22
-->

1. 本周进展围绕负责的“环境2传输通道构建”指标来做，
2. 该指标完成了“设计阶段”，现阶段设计了一套隐蔽传输方式，可能仍需一些“校验”、“冗余”等保证这种方案的鲁棒性。
3. 还剩这个“设计webex隐蔽传输方式”负责的指标继续完善。

## 隐蔽传输、微信转发/消息伪造调研

+ 隐蔽传输理论：[隐蔽通信（Covert Communication）技术概述](https://blog.csdn.net/weixin_42090358/article/details/107375357)

    讲的是Alice和Bobs、是两个正常进行通信的角色，非法窃听者Willie从中窃取，想尽可能准确的同时尽可能不被Alice和Bob发现。

    $$
    \left\{\begin{array}{l}
    \mathrm{H}_{0}: \mathbf{y}_{\mathrm{w}}=\mathbf{n}_{\mathrm{w}}, \\
    \mathrm{H}_{1}: \mathbf{y}_{\mathrm{w}}=\mathbf{x}+\mathbf{n}_{\mathrm{w}},
    \end{array}\right.
    $$

    其中$H_0$代表Alice没有发送信号，Willie只接收到高斯白噪声；反之，$H_1$代表Alice发送了信号，Willie观测到了有效信号和高斯白噪声的叠加信号。

    于是就有虚警（False Alarm）和漏检（Missed Detection），以及准确率等等一系列相关问题。

    > 这个是完全的第三方监听，收发双方完全未知，和咱们的还不一定完全一样。

+ [隐蔽传输理论](https://www.abc.net.au/chinese/2019-07-18/wechat-censorship-image-filtering/11322654)

    基本屏蔽原理：微信有一个图片MD5黑名单，一张图片MD5在黑名单中则会被屏蔽。图片被发送后微信就会被放入光学字符识别和视觉分析的队列，如果分析结果认为这张图片敏感，那么这张图片的MD5值就会被加入索引，之后用户再尝试发送就会被屏蔽。

    如果一个图片出现在一篇微信已经屏蔽的文章里，这张图片就会被屏蔽，即便这张照片本身可能并不敏感。

+ [微信记录，怎样才能成为证据(法制日报)](https://www.news.cn/politics/2021-09/12/c_1127852583.htm)

+ [如何看待微信转发聊天记录任意伪造漏洞](https://linux.do/t/topic/164751)

+ [微信被这App破解：你收到语音消息，可能是假的](https://zhuanlan.zhihu.com/p/139431237)

+ [新型诈骗！你听到的好友微信语音可能是假的！(广东声公安厅)](https://gdga.gd.gov.cn/jwzx/jwyw/content/post_2677117.html)

+ [IM消息送达保证机制实现(一)：保证在线实时消息的可靠投递(系列文章)](http://www.52im.net/thread-294-1-1.html)

## 微信消息传输收发机制

在消息传输机制中，微信采用了典型的C/S架构。用户发送消息时，客户端首先通过加密通道（比如HTTPS或者WebSocket）将数据上传至腾讯的中间服务器。服务器不仅承担消息中转的角色，还需实现临时存储、多端同步以及状态回执管理。例如，当接收方处于离线状态时，消息会被暂存于服务器的消息队列中，待用户上线后通过增量同步策略推送，这一过程通常依赖序列号或时间戳比对来避免重复或遗漏。值得注意的是，微信的端到端加密仅在私聊等特定场景下启用，其算法基于Signal协议改进，而大多数群聊消息仍依赖传输层加密保障基础安全。

多设备同步：当用户同时在手机、电脑等多终端登录时，服务器会向所有在线设备广播同一消息，各终端需维护本地消息序列以实现一致性。

有次在电脑微信上收到了消息，但是突然要出发，准备在手机上回。手机上微信没有在后台运行，启动微信时手机微信开始接收消息，恰好遇到进电梯网不好，接收到的消息还没加载出来。但是我在电脑上已经看到对方发来的消息了，所以就在消息到来之前先进行了回复。结果就是手机上显示消息变成了乱序，本来对面先发来的消息在我这里变成了交叉显示。

然后我就在想，如果这时候转发消息会变成什么样的呢？结果出了电梯开始赶路错失良机，等我到达目的地想起来这事儿再次打开微信发现消息顺序已经被还原成正常的了。

> 例如，当某设备在离线期间修改了聊天记录，重新联网后会与服务器进行冲突合并。这一机制虽然增加了服务器负载，但显著提升了跨设备体验的流畅性。[参考here](https://blog.csdn.net/ycy0706/article/details/97575645)

图片视频压缩：对于图片、短视频等小文件，微信采用分片上传策略，每片约256KB，通过HTTP/MTP协议传输至服务器后生成唯一文件标识符，接收方凭此标识符下载。为节省流量，系统默认对图片进行分辨率压缩，视频则转码为低码率MP4格式。针对文档等大文件，腾讯的对象存储系统会进行云中转，结合CDN加速节点实现全球快速分发。测试表明，超过100MB的文件传输会触发存储时限策略（通常保留72小时）。

虽然有设置P2P，但点对点直传在实际场景中极少触发，多数文件仍需经服务器中转，这可能受限于NAT穿透成功率或隐私监管要求。

## 隐蔽传输策略

已知：

1. 即时通信软件服务器不会永久保留历史消息
2. 用户本地可以永久保留历史消息
3. 多久之前的历史消息都可以被转发

那么只要：

1. 服务端不会对每一条已经不存在的消息设计一套合法性校验机制

就有：

1. 转发的消息是可以伪造的。

并且前面的调研也论证了这一点。

假设收发双方保留或备份有实际的历史消息，然后发送方在转发消息时进行伪造（例如将原本的“去上海”改成“去北京”），那么通信服务器和转发的消息看起来都没有什么不正常，但是接收方可以依据转发消息和实际历史消息的diff来获取隐蔽传输的信息了。

如果这种方案可行的话，所需要的就是“设计一套依据消息diff编码的方式”了，但暂时还没找到。