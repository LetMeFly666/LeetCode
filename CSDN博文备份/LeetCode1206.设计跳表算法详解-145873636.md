<h2><a id="LetMeFly1206_1"></a>【LetMeFly】1206.设计跳表：算法详解</h2> <br><p>力扣题目链接：<a href="https://leetcode.cn/problems/design-skiplist/" rel="nofollow">https://leetcode.cn/problems/design-skiplist/</a></p> <br><p>不使用任何库函数，设计一个 <strong>跳表</strong> 。</p> <br><p><strong>跳表</strong> 是在 <code>O(log(n))</code> 时间内完成增加、删除、搜索操作的数据结构。跳表相比于树堆与红黑树，其功能与性能相当，并且跳表的代码长度相较下更短，其设计思想与链表相似。</p> <br><p>例如，一个跳表包含 <code>[30, 40, 50, 60, 70, 90]</code> ，然后增加 <code>80</code>、<code>45</code> 到跳表中，以下图的方式操作：</p> <br><p><img alt="" src="https://i-blog.csdnimg.cn/img_convert/b8474d69c822f6bdd0563ce459e03fc7.gif" /></p> <br><p>跳表中有很多层，每一层是一个短的链表。在第一层的作用下，增加、删除和搜索操作的时间复杂度不超过 <code>O(n)</code>。跳表的每一个操作的平均时间复杂度是 <code>O(log(n))</code>，空间复杂度是 <code>O(n)</code>。</p> <br><p>了解更多 : <a href="https://oi-wiki.org/ds/skiplist/" rel="nofollow noopener noreferrer" target="_blank">https://oi-wiki.org/ds/skiplist/</a></p> <br><p>在本题中，你的设计应该要包含这些函数：</p> <br><ul><li><code>bool search(int target)</code> : 返回target是否存在于跳表中。</li><li><code>void add(int num)</code>: 插入一个元素到跳表。</li><li><code>bool erase(int num)</code>: 在跳表中删除一个值，如果 <code>num</code> 不存在，直接返回false. 如果存在多个 <code>num</code> ，删除其中任意一个即可。</li></ul> <br><p>注意，跳表中可能存在多个相同的值，你的代码需要处理这种情况。</p> <br><p> </p> <br><p><strong>示例 1:</strong></p> <br><pre><b>输入</b><br>["Skiplist", "add", "add", "add", "search", "add", "search", "erase", "erase", "search"]<br>[[], [1], [2], [3], [0], [4], [1], [0], [1], [1]]<br><strong>输出</strong><br>[null, null, null, null, false, null, true, false, true, false]<br><br><strong>解释</strong><br>Skiplist skiplist = new Skiplist();<br>skiplist.add(1);<br>skiplist.add(2);<br>skiplist.add(3);<br>skiplist.search(0);   // 返回 false<br>skiplist.add(4);<br>skiplist.search(1);   // 返回 true<br>skiplist.erase(0);    // 返回 false，0 不在跳表中<br>skiplist.erase(1);    // 返回 true<br>skiplist.search(1);   // 返回 false，1 已被擦除<br></pre> <br><p> </p> <br><p><strong>提示:</strong></p> <br><ul><li><code>0 <= num, target <= 2 * 10<sup>4</sup></code></li><li>调用<code>search</code>, <code>add</code>,  <code>erase</code>操作次数不大于 <code>5 * 10<sup>4</sup></code> </li></ul> <br><h3><a id="_62"></a>设计跳表</h3> <br><p><img src="https://i-blog.csdnimg.cn/img_convert/4d58d8acb36c5073044c17cc275ed9c8.png" alt="跳表-静态.png" /></p> <br><p>链表查询复杂度是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         O <br>        <br>       <br>         ( <br>        <br>       <br>         n <br>        <br>       <br>         ) <br>        <br>       <br>      <br>        O(n) <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>，因为要从头到尾遍历。怎么解决这个问题？多几层链表(最下层level1是全链表)，上层链表元素少，先查上层（查一次就能<strong>跳</strong>过level1好多元素），再查下层，最终查到level1。</p> <br><h4><a id="_68"></a>节点设计</h4> <br><p>对于一个节点（例如<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         50 <br>        <br>       <br>      <br>        50 <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span>），我们可以只创建一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         50 <br>        <br>       <br>      <br>        50 <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span>节点，并分别保留这个节点在level1到level3的下一个节点。</p> <br><pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">SkiplistNode</span> <span class="token punctuation">{<!-- --></span><br><span class="token keyword">public</span><span class="token operator">:</span><br>    <span class="token keyword">int</span> value<span class="token punctuation">;</span><br>    vector<span class="token operator"><</span>SkiplistNode<span class="token operator">*</span><span class="token operator">></span> next<span class="token punctuation">;</span><br><br>    <span class="token function">SkiplistNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">,</span> <span class="token keyword">int</span> level<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">value</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">next</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  <span class="token comment">// 一个节点一旦生成，level就是固定的</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br></code></pre> <br><pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Skiplist</span> <span class="token punctuation">{<!-- --></span><br><span class="token keyword">private</span><span class="token operator">:</span><br>    SkiplistNode<span class="token operator">*</span> head<span class="token punctuation">;</span>  <span class="token comment">// 为了方便，统一添加头节点</span><br>    <span class="token keyword">int</span> level<span class="token punctuation">;</span>  <span class="token comment">// 当前跳表层数，可依据实际数据范围确定</span><br><span class="token keyword">public</span><span class="token operator">:</span><br>    <span class="token function">Skiplist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SkiplistNode</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> MAX_LEVEL<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 每层一旦出现，就一定需要head节点</span><br>        level <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">bool</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><br>    <br>    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><br>    <br>    <span class="token keyword">bool</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br></code></pre> <br><h4><a id="_101"></a>查询</h4> <br><ul><li>每一层的查询依据是：找到最后一个严格小于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          t <br>         <br>        <br>          a <br>         <br>        <br>          r <br>         <br>        <br>          g <br>         <br>        <br>          e <br>         <br>        <br>          t <br>         <br>        <br>       <br>         target <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8095em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span></span></span></span></span>的节点；</li><li>上层到下层的依据是：同一个节点直接下移一层。</li></ul> <br><p><img src="https://i-blog.csdnimg.cn/img_convert/e34976dd6cfafcad3f9f42fb7a9df2bd.jpeg" alt="跳表-查60.jpg" /></p> <br><p>例如上图要查询元素<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         60 <br>        <br>       <br>      <br>        60 <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">60</span></span></span></span></span>：</p> <br><ol><li>先从最上层(level4)开始查询，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          30 <br>         <br>        <br>       <br>         30 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">30</span></span></span></span></span>是最后一个小于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          60 <br>         <br>        <br>       <br>         60 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">60</span></span></span></span></span>的元素，在<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          30 <br>         <br>        <br>       <br>         30 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">30</span></span></span></span></span>停止，跳到level3的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          30 <br>         <br>        <br>       <br>         30 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">30</span></span></span></span></span></li><li>level3从<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          30 <br>         <br>        <br>       <br>         30 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">30</span></span></span></span></span>开始向右查询，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          50 <br>         <br>        <br>       <br>         50 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span>是最后一个小于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          60 <br>         <br>        <br>       <br>         60 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">60</span></span></span></span></span>的元素，直接跳到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          50 <br>         <br>        <br>       <br>         50 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span>（可以发现最下层的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          40 <br>         <br>        <br>       <br>         40 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">40</span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          45 <br>         <br>        <br>       <br>         45 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">45</span></span></span></span></span>d都被跳过了），跳到level2的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          50 <br>         <br>        <br>       <br>         50 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span></li><li>level2从<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          50 <br>         <br>        <br>       <br>         50 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span>开始向右查询，最后一个小于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          60 <br>         <br>        <br>       <br>         60 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">60</span></span></span></span></span>的节点就是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          50 <br>         <br>        <br>       <br>         50 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span>，停止并跳到level1的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          50 <br>         <br>        <br>       <br>         50 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span></li><li>level1从<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          50 <br>         <br>        <br>       <br>         50 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span>开始向右查询，最后一个小于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          60 <br>         <br>        <br>       <br>         60 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">60</span></span></span></span></span>的节点就是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          50 <br>         <br>        <br>       <br>         50 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span>，停止。</li></ol> <br><p>最终停止的节点是level1的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         50 <br>        <br>       <br>      <br>        50 <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">50</span></span></span></span></span>。</p> <br><p><strong>注意：</strong></p> <br><ol><li>最终一定停止在level1</li><li>每一层都是在最后一个严格小于target的节点停止并移动到下层(如有)</li><li>所查询节点就是最终停止到的节点的右边相邻节点</li></ol> <br><pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>	SkiplistNode<span class="token operator">*</span> p <span class="token operator">=</span> head<span class="token punctuation">;</span>  <span class="token comment">// 从头节点开始</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 从上层到下层</span><br>        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&&</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>value <span class="token operator"><</span> target<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 每一层找到最后一个严格小于target的节点</span><br>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 最终停止到了level1的50，50在level1的next就是待查找的60</span><br>    <span class="token keyword">return</span> p <span class="token operator">&&</span> p<span class="token operator">-></span>value <span class="token operator">==</span> target<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre> <br><h4><a id="_136"></a>插入</h4> <br><p>新增一个节点，这个节点都要在哪些层出现呢？直接<code>rand</code>呗。每个节点都要在最下层出现，可以定义一个全局概率<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         P <br>        <br>       <br>      <br>        P <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span></span></span></span></span>，表示这个节点有<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         P <br>        <br>       <br>      <br>        P <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span></span></span></span></span>的概率在上一层再出现一次。</p> <br><p>对于本题，要求复杂度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>        <br>         <br>         <br>           log <br>          <br>         <br>           ⁡ <br>          <br>         <br>        <br>          2 <br>         <br>        <br>       <br>         n <br>        <br>       <br>      <br>        \log_2 n <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9386em; vertical-align: -0.2441em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.207em;"><span class="" style="top: -2.4559em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2441em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span>所以可取<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         P <br>        <br>       <br>         = <br>        <br>        <br>        <br>          1 <br>         <br>        <br>          2 <br>         <br>        <br>       <br>      <br>        P=\frac12 <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.1901em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8451em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>；最多50000次操作，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>        <br>         <br>         <br>           log <br>          <br>         <br>           ⁡ <br>          <br>         <br>        <br>          2 <br>         <br>        <br>       <br>         50000 <br>        <br>       <br>         ≈ <br>        <br>       <br>         15.6 <br>        <br>       <br>      <br>        \log_2 50000\approx 15.6 <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9386em; vertical-align: -0.2441em;"></span><span class="mop"><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.207em;"><span class="" style="top: -2.4559em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2441em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">50000</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">15.6</span></span></span></span></span>，因此可取最大层数<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         15 <br>        <br>       <br>      <br>        15 <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">15</span></span></span></span></span>。</p> <br><pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">randLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    <span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token keyword">while</span> <span class="token punctuation">(</span>ans <span class="token operator"><</span> MAX_LEVEL <span class="token operator">&&</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator"><</span> p<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        ans<span class="token operator">++</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> ans<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre> <br><p>对于新增节点<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         n <br>        <br>       <br>         u <br>        <br>       <br>         m <br>        <br>       <br>      <br>        num <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span>，假设随机出来确定它要在<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         l <br>        <br>       <br>         e <br>        <br>       <br>         v <br>        <br>       <br>         e <br>        <br>        <br>        <br>          l <br>         <br>        <br>          1 <br>         <br>        <br>       <br>      <br>        level_1 <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8444em; vertical-align: -0.15em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         l <br>        <br>       <br>         e <br>        <br>       <br>         v <br>        <br>       <br>         e <br>        <br>        <br>        <br>          l <br>         <br>         <br>         <br>           n <br>          <br>         <br>           e <br>          <br>         <br>           w <br>          <br>         <br>           L <br>          <br>         <br>           e <br>          <br>         <br>           v <br>          <br>         <br>           e <br>          <br>         <br>           l <br>          <br>         <br>        <br>       <br>      <br>        level_{newLevel} <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8444em; vertical-align: -0.15em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em;">w</span><span class="mord mathnormal mtight">L</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right: 0.0197em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>层出现，那么就可以创建一个大小为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         n <br>        <br>       <br>         e <br>        <br>       <br>         w <br>        <br>       <br>         L <br>        <br>       <br>         e <br>        <br>       <br>         v <br>        <br>       <br>         e <br>        <br>       <br>         l <br>        <br>       <br>      <br>        newLevel <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mord mathnormal">L</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span></span></span></span></span>的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         u <br>        <br>       <br>         p <br>        <br>       <br>         d <br>        <br>       <br>         a <br>        <br>       <br>         t <br>        <br>       <br>         e <br>        <br>       <br>      <br>        update <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span></span>数组，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         u <br>        <br>       <br>         p <br>        <br>       <br>         d <br>        <br>       <br>         a <br>        <br>       <br>         t <br>        <br>       <br>         e <br>        <br>       <br>         [ <br>        <br>       <br>         i <br>        <br>       <br>         ] <br>        <br>       <br>         = <br>        <br>       <br>         p <br>        <br>       <br>      <br>        update[i]=p <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span></span>代表<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         l <br>        <br>       <br>         e <br>        <br>       <br>         v <br>        <br>       <br>         e <br>        <br>        <br>        <br>          l <br>         <br>         <br>         <br>           i <br>          <br>         <br>           + <br>          <br>         <br>           1 <br>          <br>         <br>        <br>       <br>      <br>        level_{i+1} <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9028em; vertical-align: -0.2083em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span></span></span></span></span>层<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         p <br>        <br>       <br>      <br>        p <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span></span>元素的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         n <br>        <br>       <br>         e <br>        <br>       <br>         x <br>        <br>       <br>         t <br>        <br>       <br>      <br>        next <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6151em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span></span></span></span></span>需要修改为指向新节点。</p> <br><p>确定<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         u <br>        <br>       <br>         p <br>        <br>       <br>         d <br>        <br>       <br>         a <br>        <br>       <br>         t <br>        <br>       <br>         e <br>        <br>       <br>      <br>        update <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span></span>数组的方法和查询类似，每层找到最后一个严格小于<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         n <br>        <br>       <br>         u <br>        <br>       <br>         m <br>        <br>       <br>      <br>        num <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span>的节点即可。</p> <br><pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    <span class="token keyword">int</span> newLevel <span class="token operator">=</span> <span class="token function">randLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    vector<span class="token operator"><</span>SkiplistNode<span class="token operator">*</span><span class="token operator">></span> <span class="token function">update</span><span class="token punctuation">(</span>newLevel<span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 默认值为head</span><br>    SkiplistNode<span class="token operator">*</span> p <span class="token operator">=</span> head<span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&&</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>value <span class="token operator"><</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 每层找最后一个严格小于num的节点</span><br>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator"><</span> newLevel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 只有低newLevel层需要插入p节点</span><br>            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    level <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span> newLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 更新跳表最大层数</span><br>    SkiplistNode<span class="token operator">*</span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SkiplistNode</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> newLevel<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator"><</span> newLevel<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 低newLevel层每层插入新节点</span><br>        newNode<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>        update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> newNode<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre> <br><h4><a id="_179"></a>删除</h4> <br><p>删除和新增类似，找到每层需要更新next的节点，更新next并更新层数。</p> <br><p>与插入不同的是，在开始遍历前不知道<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         n <br>        <br>       <br>         u <br>        <br>       <br>         m <br>        <br>       <br>      <br>        num <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span>一共有几层，所以我们可以初始化<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         u <br>        <br>       <br>         p <br>        <br>       <br>         d <br>        <br>       <br>         a <br>        <br>       <br>         t <br>        <br>       <br>         e <br>        <br>       <br>      <br>        update <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span></span>大小为当前跳表的总层数。在真正删除节点时从最下层往最上层删除，一旦update[i]的next不是目标节点了就直接break。</p> <br><p>注意，若<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         n <br>        <br>       <br>         u <br>        <br>       <br>         m <br>        <br>       <br>      <br>        num <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span>本身就不再跳表中就不要误删其他元素了。</p> <br><p>删除完目标节点后，从上到下遍历确定是否有空层（head的next直接为null）需要删除即可。</p> <br><pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    vector<span class="token operator"><</span>SkiplistNode<span class="token operator">*</span><span class="token operator">></span> <span class="token function">update</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 其实并不需要初始值</span><br>    SkiplistNode<span class="token operator">*</span> p <span class="token operator">=</span> head<span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&&</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>value <span class="token operator"><</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 每层找最后一个严格小于num的节点</span><br>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        update<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <br>    p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 目标节点</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p <span class="token operator">||</span> p<span class="token operator">-></span>value <span class="token operator">!=</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// num在跳表中根本不存在</span><br>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator"><</span> level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 从下往上开始删除目标节点</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> p<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">break</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">delete</span> p<span class="token punctuation">;</span><br><br>    <span class="token keyword">while</span> <span class="token punctuation">(</span>level <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&&</span> <span class="token operator">!</span>head<span class="token operator">-></span>next<span class="token punctuation">[</span>level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// “移除”空层</span><br>        level<span class="token operator">--</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre> <br><h3><a id="_220"></a>时空复杂度</h3> <br><ul><li>时间复杂度：单次操作<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          O <br>         <br>        <br>          ( <br>         <br>        <br>          log <br>         <br>        <br>          ⁡ <br>         <br>        <br>          n <br>         <br>        <br>          ) <br>         <br>        <br>       <br>         O(\log n) <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span></li><li>空间复杂度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          O <br>         <br>        <br>          ( <br>         <br>        <br>          n <br>         <br>        <br>          ) <br>         <br>        <br>       <br>         O(n) <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span></li></ul> <br><h3><a id="AC_225"></a>AC代码</h3> <br><h4><a id="C_227"></a>C++</h4> <br><pre><code class="prism language-cpp"><span class="token keyword">const</span> <span class="token keyword">int</span> MAX_LEVEL <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token keyword">double</span> p <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">SkiplistNode</span> <span class="token punctuation">{<!-- --></span><br><span class="token keyword">public</span><span class="token operator">:</span><br>    <span class="token keyword">int</span> value<span class="token punctuation">;</span><br>    vector<span class="token operator"><</span>SkiplistNode<span class="token operator">*</span><span class="token operator">></span> next<span class="token punctuation">;</span><br><br>    <span class="token function">SkiplistNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">,</span> <span class="token keyword">int</span> level<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">value</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">next</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  <span class="token comment">// 一个节点一旦生成，level就是固定的</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">Skiplist</span> <span class="token punctuation">{<!-- --></span><br><span class="token keyword">private</span><span class="token operator">:</span><br>    SkiplistNode<span class="token operator">*</span> head<span class="token punctuation">;</span><br>    <span class="token keyword">int</span> level<span class="token punctuation">;</span><br><br>    <span class="token keyword">int</span> <span class="token function">randLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>        <span class="token keyword">while</span> <span class="token punctuation">(</span>ans <span class="token operator"><</span> MAX_LEVEL <span class="token operator">&&</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator"><</span> p<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            ans<span class="token operator">++</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> ans<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token keyword">public</span><span class="token operator">:</span><br>    <span class="token function">Skiplist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SkiplistNode</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> MAX_LEVEL<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 每层一旦出现，就一定需要head节点</span><br>        level <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">bool</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        SkiplistNode<span class="token operator">*</span> p <span class="token operator">=</span> head<span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&&</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>value <span class="token operator"><</span> target<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>                p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token keyword">return</span> p <span class="token operator">&&</span> p<span class="token operator">-></span>value <span class="token operator">==</span> target<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">int</span> newLevel <span class="token operator">=</span> <span class="token function">randLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        vector<span class="token operator"><</span>SkiplistNode<span class="token operator">*</span><span class="token operator">></span> <span class="token function">update</span><span class="token punctuation">(</span>newLevel<span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        SkiplistNode<span class="token operator">*</span> p <span class="token operator">=</span> head<span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&&</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>value <span class="token operator"><</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>                p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator"><</span> newLevel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>                update<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br><br>        level <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span> newLevel<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        SkiplistNode<span class="token operator">*</span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SkiplistNode</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> newLevel<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator"><</span> newLevel<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            newNode<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> newNode<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">bool</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        vector<span class="token operator"><</span>SkiplistNode<span class="token operator">*</span><span class="token operator">></span> <span class="token function">update</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        SkiplistNode<span class="token operator">*</span> p <span class="token operator">=</span> head<span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&&</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>value <span class="token operator"><</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>                p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <br>        p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p <span class="token operator">||</span> p<span class="token operator">-></span>value <span class="token operator">!=</span> num<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator"><</span> level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> p<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>                <span class="token keyword">break</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">delete</span> p<span class="token punctuation">;</span><br><br>        <span class="token keyword">while</span> <span class="token punctuation">(</span>level <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&&</span> <span class="token operator">!</span>head<span class="token operator">-></span>next<span class="token punctuation">[</span>level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            level<span class="token operator">--</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * Your Skiplist object will be instantiated and called as such:<br> * Skiplist* obj = new Skiplist();<br> * bool param_1 = obj->search(target);<br> * obj->add(num);<br> * bool param_3 = obj->erase(num);<br> */</span><br></code></pre> <br><h4><a id="Python_330"></a>Python</h4> <br><pre><code class="prism language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Any<br><span class="token keyword">import</span> random<br><br><br>MAX_LEVEL <span class="token operator">=</span> <span class="token number">15</span><br>P <span class="token operator">=</span> <span class="token number">0.5</span><br><br><span class="token keyword">class</span> <span class="token class-name">SkiplistNode</span><span class="token punctuation">:</span><br>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> level<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>        self<span class="token punctuation">.</span>value <span class="token operator">=</span> v<br>        self<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">:</span> List<span class="token punctuation">[</span>SkiplistNode<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> level<br><br><span class="token keyword">class</span> <span class="token class-name">Skiplist</span><span class="token punctuation">:</span><br>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        self<span class="token punctuation">.</span>head <span class="token operator">=</span> SkiplistNode<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> MAX_LEVEL<span class="token punctuation">)</span><br>        self<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">0</span><br>    <br>    <span class="token keyword">def</span> <span class="token function">__randLevel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        ans <span class="token operator">=</span> <span class="token number">1</span><br>        <span class="token keyword">while</span> ans <span class="token operator"><</span> MAX_LEVEL <span class="token keyword">and</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator"><</span> P<span class="token punctuation">:</span><br>            ans <span class="token operator">+=</span> <span class="token number">1</span><br>        <span class="token keyword">return</span> ans<br><br>    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> target<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span><br>        p <span class="token operator">=</span> self<span class="token punctuation">.</span>head<br>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token keyword">while</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">and</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator"><</span> target<span class="token punctuation">:</span><br>                p <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><br>        p <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><br>        <span class="token comment"># return p and p.value == target  # 不可！p为None的化这一行会return None而不是False！</span><br>        <span class="token keyword">return</span> p <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> p<span class="token punctuation">.</span>value <span class="token operator">==</span> target<br><br>    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span><br>        newLevel <span class="token operator">=</span> self<span class="token punctuation">.</span>__randLevel<span class="token punctuation">(</span><span class="token punctuation">)</span><br>        update <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>head<span class="token punctuation">]</span> <span class="token operator">*</span> newLevel<br>        p <span class="token operator">=</span> self<span class="token punctuation">.</span>head<br>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token keyword">while</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">and</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator"><</span> num<span class="token punctuation">:</span><br>                p <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><br>            <span class="token keyword">if</span> i <span class="token operator"><</span> newLevel<span class="token punctuation">:</span><br>                update<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<br>        <br>        self<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>level<span class="token punctuation">,</span> newLevel<span class="token punctuation">)</span><br>        newNode <span class="token operator">=</span> SkiplistNode<span class="token punctuation">(</span>num<span class="token punctuation">,</span> newLevel<span class="token punctuation">)</span><br>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>newLevel<span class="token punctuation">)</span><span class="token punctuation">:</span><br>            newNode<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><br>            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> newNode<br><br>    <span class="token keyword">def</span> <span class="token function">erase</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span><br>        update<span class="token punctuation">:</span> List<span class="token punctuation">[</span>SkiplistNode <span class="token operator">|</span> Any<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>level<br>        p <span class="token operator">=</span> self<span class="token punctuation">.</span>head<br>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token keyword">while</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">and</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator"><</span> num<span class="token punctuation">:</span><br>                p <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><br>            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<br>        <br>        p <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><br>        <span class="token keyword">if</span> <span class="token keyword">not</span> p <span class="token keyword">or</span> p<span class="token punctuation">.</span>value <span class="token operator">!=</span> num<span class="token punctuation">:</span><br>            <span class="token keyword">return</span> <span class="token boolean">False</span><br>        <br>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>level<span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token keyword">if</span> update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> p<span class="token punctuation">:</span><br>                <span class="token keyword">break</span><br>            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><br>        <span class="token keyword">while</span> self<span class="token punctuation">.</span>level <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><br>            self<span class="token punctuation">.</span>level <span class="token operator">-=</span> <span class="token number">1</span><br>        <span class="token keyword">return</span> <span class="token boolean">True</span><br><br><br><span class="token comment"># Your Skiplist object will be instantiated and called as such:</span><br><span class="token comment"># obj = Skiplist()</span><br><span class="token comment"># param_1 = obj.search(target)</span><br><span class="token comment"># obj.add(num)</span><br><span class="token comment"># param_3 = obj.erase(num)</span><br></code></pre> <br><blockquote> <br> <p>同步发文于<a href="https://letmefly.blog.csdn.net/article/details/145873636" rel="nofollow">CSDN</a>和我的<a href="https://blog.letmefly.xyz/" rel="nofollow">个人博客</a>，原创不易，转载经作者同意后请附上<a href="https://blog.letmefly.xyz/2025/02/26/LeetCode%201206.%E8%AE%BE%E8%AE%A1%E8%B7%B3%E8%A1%A8/" rel="nofollow">原文链接</a>哦~</p> <br> <p>千篇源码题解<a href="https://github.com/LetMeFly666/LeetCode">已开源</a></p> <br></blockquote>