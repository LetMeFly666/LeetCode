<h2><a id="Cloudflare_workers___2"></a>Cloudflare workers - 如何使用（起步篇）</h2> <br><p>Cloudflare Workers 是一种基于 JavaScript 的无服务器计算平台，允许你在 Cloudflare 的边缘网络上运行代码，而无需管理传统的服务器基础设施。它能在全球范围内的 Cloudflare 数据中心上执行代码，以提供快速、低延迟的服务。</p> <br><h3><a id="Cloudflare_workers_6"></a>创建Cloudflare workers应用</h3> <br><ol><li> <p>安装<code>wrangler</code></p> <br>  <ol><li> <p>确保机器上安装了<a href="https://nodejs.org/zh-cn" rel="nofollow">Node.js</a></p> </li><li> <p>使用<code>npm</code>安装<code>wrangler</code>：</p> <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> wrangler<br></code></pre> <p>或者使用<code>yarn</code>安装：</p> <pre><code class="prism language-bash"><span class="token function">yarn</span> global <span class="token function">add</span> wrangler<br></code></pre> </li></ol> </li><li> <p>登录Cloudflare账号</p> <br>  <ol><li> <p>执行命令：</p> <pre><code class="prism language-bash">wrangler login<br></code></pre> </li><li> <p>在弹出的浏览器窗口中登录Cloudflare账户（这里可能需要一下特殊网络环境）</p> </li><li> <p>如果你使用<code>powershell</code>运行且提示：</p> <pre><code>wrangler : 无法加载文件 F:\OtherApps\Program\Node\node-v16.13.1-win-x64\wrangler.ps1，因为在此系统上禁止运行脚本。有关详细信息，请参阅 https:/go.microsoft.com/fwlink/?LinkID=135170 中的 about_Execution_Policies。<br>所在位置 行:1 字符: 1<br>+ wrangler<br>+ ~~~~~~~~<br>    + CategoryInfo          : SecurityError: (:) []，PSSecurityException<br>    + FullyQualifiedErrorId : UnauthorizedAccess<br></code></pre> <p>那么可以使用如下命令允许本地脚本运行，并要求从互联网下载的脚本必须有有效的签名：</p> <pre><code class="prism language-powershell"><span class="token function">Set-ExecutionPolicy</span> RemoteSigned <span class="token operator">-</span>Scope CurrentUser<br></code></pre> <p>如果希望恢复禁止所有脚本运行，可以使用如下命令恢复：</p> <pre><code class="prism language-powershell"><span class="token function">Set-ExecutionPolicy</span> Restricted <span class="token operator">-</span>Scope CurrentUser<br></code></pre> </li></ol> </li><li> <p>创建Worker项目</p> <p>创建一个名为<code>api</code>的项目：</p> <pre><code class="prism language-bash">wrangler generate api<br></code></pre> <p>这将会在当前目录下生成一个<code>api</code>文件夹，文件中中包含一个<code>wrangler.toml</code>文件：</p> <pre><code class="prism language-toml">name = "api"<br>compatibility_date = "2024-12-09"<br></code></pre> </li><li> <p>编写Worker代码</p> <p>在生成的<code>api</code>文件夹下，创建<code>index.js</code>文件并写入以下内容：</p> <pre><code class="prism language-javascript"><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{<!-- --></span><br>    event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Hello, world!'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br></code></pre> <p>编辑<code>wrangler.toml</code>，添加如下一行（设置入口点为<code>index.js</code>）</p> <pre><code class="prism language-toml">main = "index.js"<br></code></pre> </li><li> <p>开发和测试</p> <p>使用以下命令在本地开发和测试：</p> <pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> api<br>wrangler dev<br></code></pre> <p>如果出现以下报错，请安装<a href="https://learn.microsoft.com/zh-cn/cpp/windows/latest-supported-vc-redist" rel="nofollow">vc_redist</a>最新版</p> <pre><code>X [ERROR] There was an access violation in the runtime.<br><br>On Windows, this may be caused by an outdated Microsoft Visual C++ Redistributable library.<br>Check that you have the latest version installed.<br>See https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist.<br><br><br><br>X [ERROR] The Workers runtime failed to start. There is likely additional logging output above.<br></code></pre> </li><li> <p>部署到Cloudflare</p> <pre><code class="prism language-bash">wrangler deploy<br></code></pre> </li><li> <p>拉取代码到本地</p> <p>如果在Cloudflare dashboard（网页端）对内容进行了修改，可执行以下命令将内容拉取到本地：</p> <pre><code>emm，似乎只能手动复制文件的到本地。。<br></code></pre> </li></ol> <br><h2><a id="End_131"></a>End</h2> <br><center> <br> <font size="6px" face="Ink Free">The End, thanks!</font> <br></center> <br><blockquote> <br> <p>原创不易，转载请附上<a href="https://blog.letmefly.xyz/2024/12/09/Other-CloudflareWorkers-How2use/" rel="nofollow">原文链接</a>哦~<br /> Tisfy：<a href="https://letmefly.blog.csdn.net/article/details/144488128" rel="nofollow">https://letmefly.blog.csdn.net/article/details/144488128</a></p> <br></blockquote>