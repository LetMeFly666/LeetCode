<h2><a id="LetMeFly762mask_O1_1"></a>【LetMeFly】762.二进制表示中质数个计算置位：位运算（mask O(1)判断）</h2> <br><p>力扣题目链接：<a href="https://leetcode.cn/problems/prime-number-of-set-bits-in-binary-representation/" rel="nofollow">https://leetcode.cn/problems/prime-number-of-set-bits-in-binary-representation/</a></p> <br><p>给你两个整数 <code>left</code> 和 <code>right</code> ，在闭区间 <code>[left, right]</code> 范围内，统计并返回 <strong>计算置位位数为质数</strong> 的整数个数。</p> <br><p><strong>计算置位位数</strong> 就是二进制表示中 <code>1</code> 的个数。</p> <br><ul><li>例如， <code>21</code> 的二进制表示 <code>10101</code> 有 <code>3</code> 个计算置位。</li></ul> <br><p> </p> <br><p><strong>示例 1：</strong></p> <br><pre><strong>输入：</strong>left = 6, right = 10<br><strong>输出：</strong>4<br><strong>解释：</strong><br>6 -> 110 (2 个计算置位，2 是质数)<br>7 -> 111 (3 个计算置位，3 是质数)<br>9 -> 1001 (2 个计算置位，2 是质数)<br>10-> 1010 (2 个计算置位，2 是质数)<br>共计 4 个计算置位为质数的数字。<br></pre> <br><p><strong>示例 2：</strong></p> <br><pre><strong>输入：</strong>left = 10, right = 15<br><strong>输出：</strong>5<br><strong>解释：</strong><br>10 -> 1010 (2 个计算置位, 2 是质数)<br>11 -> 1011 (3 个计算置位, 3 是质数)<br>12 -> 1100 (2 个计算置位, 2 是质数)<br>13 -> 1101 (3 个计算置位, 3 是质数)<br>14 -> 1110 (3 个计算置位, 3 是质数)<br>15 -> 1111 (4 个计算置位, 4 不是质数)<br>共计 5 个计算置位为质数的数字。<br></pre> <br><p> </p> <br><p><strong>提示：</strong></p> <br><ul><li><code>1 <= left <= right <= 10<sup>6</sup></code></li><li><code>0 <= right - left <= 10<sup>4</sup></code></li></ul> <br><h3><a id="_54"></a>解题方法：预处理</h3> <br><p>写个脚本，计算<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        <br>         10<br>        <br>        <br>         6<br>        <br>       <br>      <br>      <br>       10^6<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span></span>范围内二进制下最多有多少个1：<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        <br>         1<br>        <br>        <br>         20<br>        <br>       <br>       <br>        =<br>       <br>       <br>        1048576<br>       <br>      <br>      <br>       1^{20}=1048576<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8141em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">20</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1048576</span></span></span></span></span></p> <br><p>再算出来其中都有哪些是质数：<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        [<br>       <br>       <br>        2<br>       <br>       <br>        ,<br>       <br>       <br>        3<br>       <br>       <br>        ,<br>       <br>       <br>        5<br>       <br>       <br>        ,<br>       <br>       <br>        7<br>       <br>       <br>        ,<br>       <br>       <br>        11<br>       <br>       <br>        ,<br>       <br>       <br>        13<br>       <br>       <br>        ,<br>       <br>       <br>        17<br>       <br>       <br>        ,<br>       <br>       <br>        19<br>       <br>       <br>        ]<br>       <br>      <br>      <br>       [2, 3, 5, 7, 11, 13, 17, 19]<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">7</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">11</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">13</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">17</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">19</span><span class="mclose">]</span></span></span></span></span></p> <br><p>再使用一个整数二进制下的每一位代表一个数是否是质数。</p> <br><pre><code class="prism language-python"><span class="token triple-quoted-string string">'''<br>LastEditTime: 2026-02-21 12:22:44<br>'''</span><br>max_length <span class="token operator">=</span> <span class="token number">0</span><br><span class="token keyword">while</span> <span class="token number">1</span> <span class="token operator"><<</span> max_length <span class="token operator"><</span> <span class="token number">1000000</span><span class="token punctuation">:</span><br>    max_length <span class="token operator">+=</span> <span class="token number">1</span><br><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'max_length: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>max_length<span class="token punctuation">}</span></span><span class="token string">, 1 << </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>max_length<span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token number">1</span> <span class="token operator"><<</span> max_length<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><br><br>primes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> max_length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    isnot <span class="token operator">=</span> <span class="token boolean">False</span><br>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">if</span> i <span class="token operator">%</span> j <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span><br>            isnot <span class="token operator">=</span> <span class="token boolean">True</span><br>            <span class="token keyword">break</span><br>    <span class="token keyword">if</span> <span class="token keyword">not</span> isnot<span class="token punctuation">:</span><br>        primes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span><br><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'primes: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>primes<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><br><br>mask <span class="token operator">=</span> <span class="token number">0</span><br><span class="token keyword">for</span> p <span class="token keyword">in</span> primes<span class="token punctuation">:</span><br>    mask <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span> <span class="token operator"><<</span> p<br><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'mask: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mask<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><br><br><span class="token triple-quoted-string string">"""<br>max_length: 20, 1 << 20 = 1048576<br>primes: [2, 3, 5, 7, 11, 13, 17, 19]<br>mask: 665772<br>"""</span><br></code></pre> <br><ul><li>时间复杂度<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>     <br>      <br>       <br>        <br>         O<br>        <br>        <br>         (<br>        <br>        <br>         r<br>        <br>        <br>         i<br>        <br>        <br>         g<br>        <br>        <br>         h<br>        <br>        <br>         t<br>        <br>        <br>         −<br>        <br>        <br>         l<br>        <br>        <br>         e<br>        <br>        <br>         f<br>        <br>        <br>         t<br>        <br>        <br>         )<br>        <br>       <br>       <br>        O(right - left)<br>       <br>      <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span></li><li>空间复杂度<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>     <br>      <br>       <br>        <br>         O<br>        <br>        <br>         (<br>        <br>        <br>         N<br>        <br>        <br>         log<br>        <br>        <br>         ⁡<br>        <br>        <br>         N<br>        <br>        <br>         )<br>        <br>       <br>       <br>        O(N\log N)<br>       <br>      <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="mclose">)</span></span></span></span></span></li></ul> <br><h4><a id="AC_97"></a>AC代码</h4> <br><h5><a id="C_99"></a>C++</h5> <br><pre><code class="prism language-cpp"><span class="token comment">/*<br> * @LastEditTime: 2026-02-21 12:28:09<br> */</span><br><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{<!-- --></span><br><span class="token keyword">private</span><span class="token operator">:</span><br>    <span class="token keyword">constexpr</span> <span class="token keyword">static</span> <span class="token keyword">int</span> mask <span class="token operator">=</span> <span class="token number">665772</span><span class="token punctuation">;</span><br><span class="token keyword">public</span><span class="token operator">:</span><br>    <span class="token keyword">int</span> <span class="token function">countPrimeSetBits</span><span class="token punctuation">(</span><span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> left<span class="token punctuation">;</span> i <span class="token operator"><=</span> right<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">if</span> <span class="token punctuation">(</span>mask <span class="token operator">&</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator"><<</span> <span class="token function">__builtin_popcount</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>                <span class="token comment">// printf("i = %d, cnt1 = %d\n", i, __builtin_popcount(i));</span><br>                ans<span class="token operator">++</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> ans<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br></code></pre> <br><blockquote> <br> <p>同步发文于<a href="https://letmefly.blog.csdn.net/article/details/158262877" rel="nofollow">CSDN</a>和我的<a href="https://blog.letmefly.xyz/" rel="nofollow">个人博客</a>，原创不易，转载经作者同意后请附上<a href="https://blog.letmefly.xyz/2026/02/21/LeetCode%200762.%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%A1%A8%E7%A4%BA%E4%B8%AD%E8%B4%A8%E6%95%B0%E4%B8%AA%E8%AE%A1%E7%AE%97%E7%BD%AE%E4%BD%8D/" rel="nofollow">原文链接</a>哦~</p> <br> <p>千篇源码题解<a href="https://github.com/LetMeFly666/LeetCode">已开源</a></p> <br></blockquote>