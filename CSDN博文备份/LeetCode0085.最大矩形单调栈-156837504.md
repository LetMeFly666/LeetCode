<h2><a id="LetMeFly85_1"></a>【LetMeFly】85.最大矩形：单调栈</h2> <br><p>力扣题目链接：<a href="https://leetcode.cn/problems/maximal-rectangle/" rel="nofollow">https://leetcode.cn/problems/maximal-rectangle/</a></p> <br><p>给定一个仅包含 <code>0</code> 和 <code>1</code> 、大小为 <code>rows x cols</code> 的二维二进制矩阵，找出只包含 <code>1</code> 的最大矩形，并返回其面积。</p> <br><p> </p> <br><p><strong>示例 1：</strong></p> <br><img alt="" src="https://i-blog.csdnimg.cn/img_convert/277d181dc9bcc51994d3308360030b82.png" /> <br><pre><strong>输入：</strong>matrix = [["1","0","1","0","0"],["1","0","1","1","1"],["1","1","1","1","1"],["1","0","0","1","0"]]<br><strong>输出：</strong>6<br><strong>解释：</strong>最大矩形如上图所示。<br></pre> <br><p><strong>示例 2：</strong></p> <br><pre><strong>输入：</strong>matrix = [["0"]]<br><strong>输出：</strong>0<br></pre> <br><p><strong>示例 3：</strong></p> <br><pre><strong>输入：</strong>matrix = [["1"]]<br><strong>输出：</strong>1<br></pre> <br><p> </p> <br><p><strong>提示：</strong></p> <br><ul><li><code>rows == matrix.length</code></li><li><code>cols == matrix[0].length</code></li><li><code>1 <= row, cols <= 200</code></li><li><code>matrix[i][j]</code> 为 <code>'0'</code> 或 <code>'1'</code></li></ul> <br><h3><a id="_44"></a>解题方法：单调栈</h3> <br><img src="https://i-blog.csdnimg.cn/img_convert/8fc973f1c140cca1c1f8e0697955bc03.jpeg" /> <br><p>先看<a href="https://leetcode.cn/problems/largest-rectangle-in-histogram" rel="nofollow">84. 柱状图中最大的矩形</a>，求n个相邻柱子的最大面积：</p> <br><blockquote> <br> <p>使用一个单调递增栈，柱子前后加两个高度为0的哨兵。</p> <br> <p>某个柱子被逐出栈时，说明其左右最多能延伸到的柱子分别是“栈顶柱子”、“将其逐出的柱子”（左右不含），以其为高的最大矩形面积为<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>     <br>      <br>       <br>        <br>         其高<br>        <br>        <br>         ×<br>        <br>        <br>         (<br>        <br>        <br>         右柱子<br>        <br>        <br>         −<br>        <br>        <br>         左柱子<br>        <br>        <br>         −<br>        <br>        <br>         1<br>        <br>        <br>         )<br>        <br>       <br>       <br>        其高\times(右柱子-左柱子-1)<br>       <br>      <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;"></span><span class="mord cjk_fallback">其高</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">右柱子</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;"></span><span class="mord cjk_fallback">左柱子</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>。</p> <br> <pre><code class="prism language-cpp"><span class="token comment">/*<br> * @LastEditTime: 2026-01-11 22:44:08<br> */</span><br><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{<!-- --></span><br><span class="token keyword">public</span><span class="token operator">:</span><br>    <span class="token keyword">int</span> <span class="token function">largestRectangleArea</span><span class="token punctuation">(</span>vector<span class="token operator"><</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&</span> heights<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        stack<span class="token operator"><</span><span class="token keyword">int</span><span class="token operator">></span> idx<span class="token punctuation">;</span><br>        heights<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>heights<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        heights<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator"><</span> heights<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">while</span> <span class="token punctuation">(</span>idx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&&</span> heights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator"><</span> heights<span class="token punctuation">[</span>idx<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>                <span class="token keyword">int</span> lastIdx <span class="token operator">=</span> idx<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                idx<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                ans <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>ans<span class="token punctuation">,</span> heights<span class="token punctuation">[</span>lastIdx<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> idx<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>            idx<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> ans<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br></code></pre> <br></blockquote> <br><p>这道题是一样的，对于<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        n<br>       <br>      <br>      <br>       n<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span>行的matrix，以第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        i<br>       <br>      <br>      <br>       i<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></span>行为底第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        1<br>       <br>      <br>      <br>       1<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>行为顶的子矩阵共<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        n<br>       <br>      <br>      <br>       n<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span>个，可以做<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        n<br>       <br>      <br>      <br>       n<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span>次上面的单调栈。</p> <br><p>对于下面的matrix：</p> <br><pre><code>1 0 1 0 0<br>1 0 1 1 1<br>1 1 1 1 1<br></code></pre> <br><p>相当于：</p> <br><ol><li> <p>第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>      <br>       <br>        <br>         <br>          1<br>         <br>        <br>        <br>         1<br>        <br>       <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>行到第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>      <br>       <br>        <br>         <br>          1<br>         <br>        <br>        <br>         1<br>        <br>       <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>行的子矩阵：</p> <pre><code>1 0 1 0 0<br></code></pre> <p>相当于高为<code>1 0 1 0 0</code>的柱子，做一次单调栈；</p> </li><li> <p>第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>      <br>       <br>        <br>         <br>          1<br>         <br>        <br>        <br>         1<br>        <br>       <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>行到第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>      <br>       <br>        <br>         <br>          2<br>         <br>        <br>        <br>         2<br>        <br>       <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">2</span></span></span></span></span>行的子矩阵：</p> <pre><code>1 0 1 0 0<br>1 0 1 1 1<br></code></pre> <p>相当于高为<code>2 0 2 1 1</code>的柱子，做一次单调栈；</p> </li><li> <p>第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>      <br>       <br>        <br>         <br>          1<br>         <br>        <br>        <br>         1<br>        <br>       <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>行到第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>      <br>       <br>        <br>         <br>          3<br>         <br>        <br>        <br>         3<br>        <br>       <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">3</span></span></span></span></span>行的子矩阵：</p> <pre><code>1 0 1 0 0<br>1 0 1 1 1<br>1 1 1 1 1<br></code></pre> <p>相当于高为<code>3 0 3 2 2</code>的柱子，做一次单调栈。</p> </li></ol> <br><p>其中由第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        i<br>       <br>      <br>      <br>       i<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></span>行为底过度到由第<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>    <br>     <br>      <br>       <br>        i<br>       <br>       <br>        +<br>       <br>       <br>        1<br>       <br>      <br>      <br>       i+1<br>      <br>     <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7429em; vertical-align: -0.0833em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>行为底时，可以借助上一行为底时的柱子高度快速更新新柱子的高度。</p> <br><ul><li>时间复杂度<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>     <br>      <br>       <br>        <br>         O<br>        <br>        <br>         (<br>        <br>        <br>         s<br>        <br>        <br>         i<br>        <br>        <br>         z<br>        <br>        <br>         e<br>        <br>        <br>         (<br>        <br>        <br>         m<br>        <br>        <br>         a<br>        <br>        <br>         t<br>        <br>        <br>         r<br>        <br>        <br>         i<br>        <br>        <br>         x<br>        <br>        <br>         )<br>        <br>        <br>         )<br>        <br>       <br>       <br>        O(size(matrix))<br>       <br>      <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mopen">(</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span></span></li><li>空间复杂度<span class="katex--inline"><span class="katex"><span class="katex-mathml"><br>     <br>      <br>       <br>        <br>         O<br>        <br>        <br>         (<br>        <br>        <br>         s<br>        <br>        <br>         i<br>        <br>        <br>         z<br>        <br>        <br>         e<br>        <br>        <br>         (<br>        <br>        <br>         m<br>        <br>        <br>         a<br>        <br>        <br>         t<br>        <br>        <br>         r<br>        <br>        <br>         i<br>        <br>        <br>         x<br>        <br>        <br>         [<br>        <br>        <br>         0<br>        <br>        <br>         ]<br>        <br>        <br>         )<br>        <br>        <br>         )<br>        <br>       <br>       <br>        O(size(matrix[0]))<br>       <br>      <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mopen">(</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]))</span></span></span></span></span>，需要一行的空间</li></ul> <br><h4><a id="AC_122"></a>AC代码</h4> <br><h5><a id="C_124"></a>C++</h5> <br><pre><code class="prism language-cpp"><span class="token comment">/*<br> * @LastEditTime: 2026-01-11 23:13:41<br> */</span><br><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{<!-- --></span><br><span class="token keyword">public</span><span class="token operator">:</span><br>    <span class="token keyword">int</span> <span class="token function">maximalRectangle</span><span class="token punctuation">(</span>vector<span class="token operator"><</span>vector<span class="token operator"><</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token operator">&</span> matrix<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>        vector<span class="token operator"><</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">heights</span><span class="token punctuation">(</span>matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator"><</span> matrix<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            stack<span class="token operator"><</span><span class="token keyword">int</span><span class="token operator">></span> st<span class="token punctuation">;</span><br>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator"><</span> matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>                heights<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> heights<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&&</span> matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'1'</span> <span class="token operator">?</span> heights<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'1'</span><span class="token punctuation">;</span><br>                <span class="token keyword">while</span> <span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&&</span> heights<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator"><</span> heights<span class="token punctuation">[</span>st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 记得st.size()也要判断，否则哨兵0会驱逐哨兵0</span><br>                    <span class="token keyword">int</span> idx <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                    st<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                    ans <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>ans<span class="token punctuation">,</span> heights<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token punctuation">}</span><br>                st<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> ans<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br></code></pre> <br><blockquote> <br> <p>同步发文于<a href="https://letmefly.blog.csdn.net/article/details/156837504" rel="nofollow">CSDN</a>和我的<a href="https://blog.letmefly.xyz/" rel="nofollow">个人博客</a>，原创不易，转载经作者同意后请附上<a href="https://blog.letmefly.xyz/2026/01/11/LeetCode%200085.%E6%9C%80%E5%A4%A7%E7%9F%A9%E5%BD%A2/" rel="nofollow">原文链接</a>哦~</p> <br> <p>千篇源码题解<a href="https://github.com/LetMeFly666/LeetCode">已开源</a></p> <br></blockquote>