<h2><a id="LetMeFly3165_1"></a>【LetMeFly】3165.不包含相邻元素的子序列的最大和：单点修改的线段树（动态规划）</h2> <br><p>力扣题目链接：<a href="https://leetcode.cn/problems/maximum-sum-of-subsequence-with-non-adjacent-elements/" rel="nofollow">https://leetcode.cn/problems/maximum-sum-of-subsequence-with-non-adjacent-elements/</a></p> <br><p>给你一个整数数组 <code>nums</code> 和一个二维数组 <code>queries</code>，其中 <code>queries[i] = [pos<sub>i</sub>, x<sub>i</sub>]</code>。</p> <br><p>对于每个查询 <code>i</code>，首先将 <code>nums[pos<sub>i</sub>]</code> 设置为 <code>x<sub>i</sub></code>，然后计算查询 <code>i</code> 的答案，该答案为 <code>nums</code> 中 <strong>不包含相邻元素 </strong>的 子序列 的 <strong>最大 </strong>和。</p> <br><p>返回所有查询的答案之和。</p> <br><p>由于最终答案可能非常大，返回其对 <code>10<sup>9</sup> + 7</code> <strong>取余</strong> 的结果。</p> <br><p><strong>子序列</strong> 是指从另一个数组中删除一些或不删除元素而不改变剩余元素顺序得到的数组。</p> <br><p> </p> <br><p><strong class="example">示例 1：</strong></p> <br><div class="example-block"> <br> <p><strong>输入：</strong><span class="example-io">nums = [3,5,9], queries = [[1,-2],[0,-3]]</span></p> <br></div> <br><p><strong>输出：</strong><span class="example-io">21</span></p> <br><p><strong>解释：</strong><br /> 执行第 1 个查询后，<code>nums = [3,-2,9]</code>，不包含相邻元素的子序列的最大和为 <code>3 + 9 = 12</code>。<br /> 执行第 2 个查询后，<code>nums = [-3,-2,9]</code>，不包含相邻元素的子序列的最大和为 9 。</p> <br><p><strong class="example">示例 2：</strong></p> <br><div class="example-block"> <br> <p><strong>输入：</strong><span class="example-io">nums = [0,-1], queries = [[0,-5]]</span></p> <br></div> <br><p><strong>输出：</strong><span class="example-io">0</span></p> <br><p><strong>解释：</strong><br /> 执行第 1 个查询后，<code>nums = [-5,-1]</code>，不包含相邻元素的子序列的最大和为 0（选择空子序列）。</p> <br><p> </p> <br><p><strong>提示：</strong></p> <br><ul><li><code>1 <= nums.length <= 5 * 10<sup>4</sup></code></li><li><code>-10<sup>5</sup> <= nums[i] <= 10<sup>5</sup></code></li><li><code>1 <= queries.length <= 5 * 10<sup>4</sup></code></li><li><code>queries[i] == [pos<sub>i</sub>, x<sub>i</sub>]</code></li><li><code>0 <= pos<sub>i</sub> <= nums.length - 1</code></li><li><code>-10<sup>5</sup> <= x<sub>i</sub> <= 10<sup>5</sup></code></li></ul> <br><h3><a id="__DP_55"></a>解题方法：线段树 + DP</h3> <br><p>对于单次操作，我们可以使用分治的方法来求解。对于一个子区间，我们比较关注的有：区间第一个元素是否被选取、区间最后一个元素是否被选取。也就是说，对于一个子区间，一共有以下4种情况：</p> <br><ul><li>开头一定不选，结尾一定不选，记为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          f <br>         <br>        <br>          00 <br>         <br>        <br>       <br>         f00 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">00</span></span></span></span></span></li><li>开头一定不选，结尾可选(也可不选)，记为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          f <br>         <br>        <br>          01 <br>         <br>        <br>       <br>         f01 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">01</span></span></span></span></span></li><li>开头可选(也可不选)，结尾一定不选，记为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          f <br>         <br>        <br>          10 <br>         <br>        <br>       <br>         f10 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">10</span></span></span></span></span></li><li>开头可选(也可不选)，结尾可选(也可不选)，记为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          f <br>         <br>        <br>          11 <br>         <br>        <br>       <br>         f11 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">11</span></span></span></span></span></li></ul> <br><p>那么对于区间<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         [ <br>        <br>       <br>         l <br>        <br>       <br>         e <br>        <br>       <br>         f <br>        <br>       <br>         t <br>        <br>       <br>         , <br>        <br>       <br>         r <br>        <br>       <br>         i <br>        <br>       <br>         g <br>        <br>       <br>         h <br>        <br>       <br>         t <br>        <br>       <br>         ] <br>        <br>       <br>      <br>        [left, right] <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mclose">]</span></span></span></span></span>，如何进行分治操作呢？</p> <br><ul><li> <p>如果<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>       <br>        <br>         <br>         <br>           l <br>          <br>         <br>           e <br>          <br>         <br>           f <br>          <br>         <br>           t <br>          <br>         <br>           = <br>          <br>         <br>           = <br>          <br>         <br>           r <br>          <br>         <br>           i <br>          <br>         <br>           g <br>          <br>         <br>           h <br>          <br>         <br>           t <br>          <br>         <br>        <br>          left==right <br>         <br>        <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span></span></span></span></span>，那么这个区间就只有一个元素，这个区间的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>       <br>        <br>         <br>         <br>           f <br>          <br>         <br>           00 <br>          <br>         <br>           = <br>          <br>         <br>           f <br>          <br>         <br>           01 <br>          <br>         <br>           = <br>          <br>         <br>           f <br>          <br>         <br>           10 <br>          <br>         <br>           = <br>          <br>         <br>           0 <br>          <br>         <br>        <br>          f00=f01=f10=0 <br>         <br>        <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">00</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">01</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">10</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span>，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>       <br>        <br>         <br>         <br>           f <br>          <br>         <br>           11 <br>          <br>         <br>           = <br>          <br>         <br>           max <br>          <br>         <br>           ⁡ <br>          <br>         <br>           ( <br>          <br>         <br>           0 <br>          <br>         <br>           , <br>          <br>         <br>           n <br>          <br>         <br>           u <br>          <br>         <br>           m <br>          <br>         <br>           s <br>          <br>         <br>           [ <br>          <br>         <br>           l <br>          <br>         <br>           e <br>          <br>         <br>           f <br>          <br>         <br>           t <br>          <br>         <br>           ] <br>          <br>         <br>           ) <br>          <br>         <br>        <br>          f11=\max(0, nums[left]) <br>         <br>        <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">11</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">t</span><span class="mclose">])</span></span></span></span></span>。</p> </li><li> <p>否则，令<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>       <br>        <br>         <br>         <br>           m <br>          <br>         <br>           i <br>          <br>         <br>           d <br>          <br>         <br>           = <br>          <br>         <br>           ⌊ <br>          <br>          <br>           <br>           <br>             l <br>            <br>           <br>             e <br>            <br>           <br>             f <br>            <br>           <br>             t <br>            <br>           <br>             + <br>            <br>           <br>             r <br>            <br>           <br>             i <br>            <br>           <br>             g <br>            <br>           <br>             h <br>            <br>           <br>             t <br>            <br>           <br>          <br>            2 <br>           <br>          <br>         <br>           ⌋ <br>          <br>         <br>        <br>          mid = \lfloor\frac{left+right}{2}\rfloor <br>         <br>        <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2772em; vertical-align: -0.345em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9322em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌋</span></span></span></span></span>，递归计算<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>       <br>        <br>         <br>         <br>           [ <br>          <br>         <br>           l <br>          <br>         <br>           e <br>          <br>         <br>           f <br>          <br>         <br>           t <br>          <br>         <br>           , <br>          <br>         <br>           m <br>          <br>         <br>           i <br>          <br>         <br>           d <br>          <br>         <br>           ] <br>          <br>         <br>        <br>          [left, mid] <br>         <br>        <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span><span class="mclose">]</span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>       <br>        <br>         <br>         <br>           [ <br>          <br>         <br>           m <br>          <br>         <br>           i <br>          <br>         <br>           d <br>          <br>         <br>           + <br>          <br>         <br>           1 <br>          <br>         <br>           , <br>          <br>         <br>           r <br>          <br>         <br>           i <br>          <br>         <br>           g <br>          <br>         <br>           h <br>          <br>         <br>           t <br>          <br>         <br>           ] <br>          <br>         <br>        <br>          [mid + 1, right] <br>         <br>        <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">mi</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mclose">]</span></span></span></span></span>两个子区间的4个值并汇总得到这个区间的4个值。</p> <p>假设左区间为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>       <br>        <br>         <br>         <br>           p <br>          <br>         <br>        <br>          p <br>         <br>        <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span></span>，右区间为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>       <br>        <br>         <br>         <br>           q <br>          <br>         <br>        <br>          q <br>         <br>        <br>      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span></span></span></span></span>，则汇总方式为：</p> <br>  <ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>        <br>         <br>          <br>          <br>            f <br>           <br>          <br>            00 <br>           <br>          <br>            = <br>           <br>          <br>            max <br>           <br>          <br>            ⁡ <br>           <br>          <br>            ( <br>           <br>           <br>           <br>             f <br>            <br>           <br>             p <br>            <br>           <br>          <br>            00 <br>           <br>          <br>            + <br>           <br>           <br>           <br>             f <br>            <br>           <br>             q <br>            <br>           <br>          <br>            10 <br>           <br>          <br>            , <br>           <br>           <br>           <br>             f <br>            <br>           <br>             p <br>            <br>           <br>          <br>            01 <br>           <br>          <br>            + <br>           <br>           <br>           <br>             f <br>            <br>           <br>             q <br>            <br>           <br>          <br>            00 <br>           <br>          <br>            ) <br>           <br>          <br>         <br>           f00 = \max(f_p00+f_q10, f_p01+f_q00) <br>          <br>         <br>       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">00</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">00</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.9805em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">10</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">01</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">00</span><span class="mclose">)</span></span></span></span></span></li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>        <br>         <br>          <br>          <br>            f <br>           <br>          <br>            01 <br>           <br>          <br>            = <br>           <br>          <br>            max <br>           <br>          <br>            ⁡ <br>           <br>          <br>            ( <br>           <br>           <br>           <br>             f <br>            <br>           <br>             p <br>            <br>           <br>          <br>            00 <br>           <br>          <br>            + <br>           <br>           <br>           <br>             f <br>            <br>           <br>             q <br>            <br>           <br>          <br>            11 <br>           <br>          <br>            , <br>           <br>           <br>           <br>             f <br>            <br>           <br>             p <br>            <br>           <br>          <br>            01 <br>           <br>          <br>            + <br>           <br>           <br>           <br>             f <br>            <br>           <br>             q <br>            <br>           <br>          <br>            01 <br>           <br>          <br>            ) <br>           <br>          <br>         <br>           f01 = \max(f_p00+f_q11, f_p01+f_q01) <br>          <br>         <br>       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">01</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">00</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.9805em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">11</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">01</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">01</span><span class="mclose">)</span></span></span></span></span></li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>        <br>         <br>          <br>          <br>            f <br>           <br>          <br>            10 <br>           <br>          <br>            = <br>           <br>          <br>            max <br>           <br>          <br>            ⁡ <br>           <br>          <br>            ( <br>           <br>           <br>           <br>             f <br>            <br>           <br>             p <br>            <br>           <br>          <br>            10 <br>           <br>          <br>            + <br>           <br>           <br>           <br>             f <br>            <br>           <br>             q <br>            <br>           <br>          <br>            10 <br>           <br>          <br>            , <br>           <br>           <br>           <br>             f <br>            <br>           <br>             p <br>            <br>           <br>          <br>            11 <br>           <br>          <br>            + <br>           <br>           <br>           <br>             f <br>            <br>           <br>             q <br>            <br>           <br>          <br>            00 <br>           <br>          <br>            ) <br>           <br>          <br>         <br>           f10 = \max(f_p10+f_q10, f_p11+f_q00) <br>          <br>         <br>       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">10</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">10</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.9805em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">10</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">11</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">00</span><span class="mclose">)</span></span></span></span></span></li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>        <br>         <br>          <br>          <br>            f <br>           <br>          <br>            11 <br>           <br>          <br>            = <br>           <br>          <br>            max <br>           <br>          <br>            ⁡ <br>           <br>          <br>            ( <br>           <br>           <br>           <br>             f <br>            <br>           <br>             p <br>            <br>           <br>          <br>            10 <br>           <br>          <br>            + <br>           <br>           <br>           <br>             f <br>            <br>           <br>             q <br>            <br>           <br>          <br>            11 <br>           <br>          <br>            , <br>           <br>           <br>           <br>             f <br>            <br>           <br>             p <br>            <br>           <br>          <br>            11 <br>           <br>          <br>            + <br>           <br>           <br>           <br>             f <br>            <br>           <br>             q <br>            <br>           <br>          <br>            01 <br>           <br>          <br>            ) <br>           <br>          <br>         <br>           f11 = \max(f_p10+f_q11, f_p11+f_q01) <br>          <br>         <br>       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">11</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">10</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.9805em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">11</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">11</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord">01</span><span class="mclose">)</span></span></span></span></span></li></ul> </li></ul> <br><p>那么如何应对<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>     <br>      <br>       <br>       <br>         l <br>        <br>       <br>         e <br>        <br>       <br>         n <br>        <br>       <br>         ( <br>        <br>       <br>         q <br>        <br>       <br>         u <br>        <br>       <br>         e <br>        <br>       <br>         r <br>        <br>       <br>         i <br>        <br>       <br>         e <br>        <br>       <br>         s <br>        <br>       <br>         ) <br>        <br>       <br>      <br>        len(queries) <br>       <br>      <br>    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right: 0.0278em;">er</span><span class="mord mathnormal">i</span><span class="mord mathnormal">es</span><span class="mclose">)</span></span></span></span></span>次的修改呢？那就需要引入<a href="https://blog.letmefly.xyz/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91" rel="nofollow">线段树</a>了。</p> <br><ul><li>对于修改操作，使用线段树实现单点修改，线段树的每个节点维护对应区间的4个值</li><li>对于查询操作，线段树根节点（整个区间）的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          f <br>         <br>        <br>          11 <br>         <br>        <br>       <br>         f11 <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord">11</span></span></span></span></span>记为所求</li></ul> <br><h4><a id="_81"></a>时空复杂度分析</h4> <br><ul><li>时间复杂度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          O <br>         <br>        <br>          ( <br>         <br>        <br>          n <br>         <br>        <br>          + <br>         <br>        <br>          q <br>         <br>        <br>          log <br>         <br>        <br>          ⁡ <br>         <br>        <br>          n <br>         <br>        <br>          ) <br>         <br>        <br>       <br>         O(n+q\log n) <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop">lo<span style="margin-right: 0.0139em;">g</span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          n <br>         <br>        <br>          = <br>         <br>        <br>          l <br>         <br>        <br>          e <br>         <br>        <br>          n <br>         <br>        <br>          ( <br>         <br>        <br>          n <br>         <br>        <br>          u <br>         <br>        <br>          m <br>         <br>        <br>          s <br>         <br>        <br>          ) <br>         <br>        <br>       <br>         n=len(nums) <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span><span class="mclose">)</span></span></span></span></span>，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          q <br>         <br>        <br>          = <br>         <br>        <br>          l <br>         <br>        <br>          e <br>         <br>        <br>          n <br>         <br>        <br>          ( <br>         <br>        <br>          q <br>         <br>        <br>          u <br>         <br>        <br>          e <br>         <br>        <br>          r <br>         <br>        <br>          i <br>         <br>        <br>          e <br>         <br>        <br>          s <br>         <br>        <br>          ) <br>         <br>        <br>       <br>         q=len(queries) <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right: 0.0278em;">er</span><span class="mord mathnormal">i</span><span class="mord mathnormal">es</span><span class="mclose">)</span></span></span></span></span></li><li>空间复杂度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> <br>      <br>       <br>        <br>        <br>          O <br>         <br>        <br>          ( <br>         <br>        <br>          n <br>         <br>        <br>          ) <br>         <br>        <br>       <br>         O(n) <br>        <br>       <br>     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span></li></ul> <br><h4><a id="AC_86"></a>AC代码</h4> <br><h5><a id="C_88"></a>C++</h5> <br><pre><code class="prism language-cpp"><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> mod <span class="token operator">=</span> <span class="token number">1e9</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{<!-- --></span><br><span class="token keyword">private</span><span class="token operator">:</span><br>    vector<span class="token operator"><</span>array<span class="token operator"><</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">>></span> tree<span class="token punctuation">;</span>  <span class="token comment">// 00, 01, 10, 11</span><br><br>    <span class="token keyword">void</span> <span class="token function">maintain</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">int</span> leftIndex <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><br>        <span class="token keyword">int</span> rightIndex <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span><br>        tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token function">max</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> tree<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tree<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> tree<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token function">max</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> tree<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tree<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> tree<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token function">max</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> tree<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tree<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> tree<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token function">max</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> tree<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tree<span class="token punctuation">[</span>leftIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> tree<span class="token punctuation">[</span>rightIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">void</span> <span class="token function">buildTree</span><span class="token punctuation">(</span>vector<span class="token operator"><</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">max</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>            <span class="token keyword">return</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>        <span class="token function">buildTree</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">buildTree</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">maintain</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> modifiedI<span class="token punctuation">,</span> <span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">return</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>modifiedI <span class="token operator"><=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token function">update</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> modifiedI<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token function">update</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">,</span> modifiedI<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token function">maintain</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token keyword">public</span><span class="token operator">:</span><br>    <span class="token keyword">int</span> <span class="token function">maximumSumSubsequence</span><span class="token punctuation">(</span>vector<span class="token operator"><</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&</span> nums<span class="token punctuation">,</span> vector<span class="token operator"><</span>vector<span class="token operator"><</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&</span> queries<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        tree<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">buildTree</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span>vector<span class="token operator"><</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&</span> query <span class="token operator">:</span> queries<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token function">update</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> query<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> query<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            ans <span class="token operator">=</span> <span class="token punctuation">(</span>ans <span class="token operator">+</span> tree<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> ans<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br></code></pre> <br><h5><a id="Python_146"></a>Python</h5> <br><pre><code class="prism language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<br><br>MOD <span class="token operator">=</span> 1_000_000_007<br><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span><br>    <span class="token keyword">def</span> <span class="token function">maintain</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span><br>        leftNode <span class="token operator">=</span> self<span class="token punctuation">.</span>tree<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><br>        rightNode <span class="token operator">=</span> self<span class="token punctuation">.</span>tree<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><br>        self<span class="token punctuation">.</span>tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><br>            <span class="token builtin">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> leftNode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token builtin">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> leftNode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token builtin">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> leftNode<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token builtin">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> leftNode<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>        <span class="token punctuation">]</span><br>    <br>    <span class="token keyword">def</span> <span class="token function">build</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> left<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span><br>        <span class="token keyword">if</span> left <span class="token operator">==</span> right<span class="token punctuation">:</span><br>            self<span class="token punctuation">.</span>tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><br>            <span class="token keyword">return</span><br>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><br>        self<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><br>        self<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><br>        self<span class="token punctuation">.</span>maintain<span class="token punctuation">(</span>index<span class="token punctuation">)</span><br><br>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> left<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> modifiedI<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span><br>        <span class="token keyword">if</span> left <span class="token operator">==</span> right<span class="token punctuation">:</span><br>            self<span class="token punctuation">.</span>tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><br>            <span class="token keyword">return</span><br>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><br>        <span class="token keyword">if</span> modifiedI <span class="token operator"><=</span> mid<span class="token punctuation">:</span><br>            self<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> modifiedI<span class="token punctuation">,</span> val<span class="token punctuation">)</span><br>        <span class="token keyword">else</span><span class="token punctuation">:</span><br>            self<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">,</span> modifiedI<span class="token punctuation">,</span> val<span class="token punctuation">)</span><br>        self<span class="token punctuation">.</span>maintain<span class="token punctuation">(</span>index<span class="token punctuation">)</span><br><br>    <span class="token keyword">def</span> <span class="token function">maximumSumSubsequence</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queries<span class="token punctuation">:</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span><br>        self<span class="token punctuation">.</span>tree <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 00, 01, 10, 11</span><br>        self<span class="token punctuation">.</span>nums <span class="token operator">=</span> nums<br>        self<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><br>        ans <span class="token operator">=</span> <span class="token number">0</span><br>        <span class="token keyword">for</span> q<span class="token punctuation">,</span> v <span class="token keyword">in</span> queries<span class="token punctuation">:</span><br>            self<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> q<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br>            ans <span class="token operator">=</span> <span class="token punctuation">(</span>ans <span class="token operator">+</span> self<span class="token punctuation">.</span>tree<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> MOD<br>        <span class="token keyword">return</span> ans<br><br></code></pre> <br><h5><a id="Java_195"></a>Java</h5> <br><pre><code class="prism language-java"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{<!-- --></span><br>    <span class="token keyword">private</span> <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tree<span class="token punctuation">;</span>  <span class="token comment">// 诶，如果不是long的话会有两组数据无法通过</span><br>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> mod <span class="token operator">=</span> <span class="token number">1000000007</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">maintain</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> leftNode <span class="token operator">=</span> tree<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rightNode <span class="token operator">=</span> tree<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> leftNode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> leftNode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> leftNode<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> leftNode<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> rightNode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">return</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>        <span class="token function">build</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">build</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">maintain</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> modifiedI<span class="token punctuation">,</span> <span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">return</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>modifiedI <span class="token operator"><=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token function">update</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> modifiedI<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token function">update</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">,</span> modifiedI<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token function">maintain</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">maximumSumSubsequence</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> queries<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        tree <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 00, 01, 10, 11</span><br>        <span class="token function">build</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">long</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> query <span class="token operator">:</span> queries<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token function">update</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> query<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> query<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            ans <span class="token operator">=</span> <span class="token punctuation">(</span>ans <span class="token operator">+</span> tree<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ans<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre> <br><h5><a id="Go_249"></a>Go</h5> <br><pre><code class="prism language-go"><span class="token keyword">package</span> main<br><br><span class="token keyword">type</span> data <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span><br>    _00 <span class="token builtin">int</span><br>    _01 <span class="token builtin">int</span><br>    _10 <span class="token builtin">int</span><br>    _11 <span class="token builtin">int</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> seg <span class="token punctuation">[</span><span class="token punctuation">]</span>data<br><br><span class="token keyword">func</span> <span class="token function">max</span><span class="token punctuation">(</span>a <span class="token builtin">int</span><span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{<!-- --></span><br>    <span class="token keyword">if</span> a <span class="token operator">>=</span> b <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">return</span> a<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> b<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">maintain</span><span class="token punctuation">(</span>tree seg<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    leftNode <span class="token operator">:=</span> tree<span class="token punctuation">[</span>index <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><br>    rightNode <span class="token operator">:=</span> tree<span class="token punctuation">[</span>index <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><br>    tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">{<!-- --></span><br>        <span class="token function">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">.</span>_00 <span class="token operator">+</span> rightNode<span class="token punctuation">.</span>_10<span class="token punctuation">,</span> leftNode<span class="token punctuation">.</span>_01 <span class="token operator">+</span> rightNode<span class="token punctuation">.</span>_00<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token function">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">.</span>_00 <span class="token operator">+</span> rightNode<span class="token punctuation">.</span>_11<span class="token punctuation">,</span> leftNode<span class="token punctuation">.</span>_01 <span class="token operator">+</span> rightNode<span class="token punctuation">.</span>_01<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token function">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">.</span>_10 <span class="token operator">+</span> rightNode<span class="token punctuation">.</span>_10<span class="token punctuation">,</span> leftNode<span class="token punctuation">.</span>_11 <span class="token operator">+</span> rightNode<span class="token punctuation">.</span>_00<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token function">max</span><span class="token punctuation">(</span>leftNode<span class="token punctuation">.</span>_10 <span class="token operator">+</span> rightNode<span class="token punctuation">.</span>_11<span class="token punctuation">,</span> leftNode<span class="token punctuation">.</span>_11 <span class="token operator">+</span> rightNode<span class="token punctuation">.</span>_01<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">build</span><span class="token punctuation">(</span>tree seg<span class="token punctuation">,</span> nums <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">,</span> left <span class="token builtin">int</span><span class="token punctuation">,</span> right <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    <span class="token keyword">if</span> left <span class="token operator">==</span> right <span class="token punctuation">{<!-- --></span><br>        tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>_11 <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span><br>    <span class="token punctuation">}</span><br>    mid <span class="token operator">:=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><br>    <span class="token function">build</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> nums<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><br>    <span class="token function">build</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> nums<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><br>    <span class="token function">maintain</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> index<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">update</span><span class="token punctuation">(</span>tree seg<span class="token punctuation">,</span> index <span class="token builtin">int</span><span class="token punctuation">,</span> left <span class="token builtin">int</span><span class="token punctuation">,</span> right <span class="token builtin">int</span><span class="token punctuation">,</span> modified <span class="token builtin">int</span><span class="token punctuation">,</span> val <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    <span class="token keyword">if</span> left <span class="token operator">==</span> right <span class="token punctuation">{<!-- --></span><br>        tree<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>_11 <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><br>        <span class="token keyword">return</span><br>    <span class="token punctuation">}</span><br>    mid <span class="token operator">:=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><br>    <span class="token keyword">if</span> modified <span class="token operator"><=</span> mid <span class="token punctuation">{<!-- --></span><br>        <span class="token function">update</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> modified<span class="token punctuation">,</span> val<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token function">update</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">,</span> modified<span class="token punctuation">,</span> val<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    <span class="token function">maintain</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> index<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">maximumSumSubsequence</span><span class="token punctuation">(</span>nums <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> queries <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{<!-- --></span><br>    tree <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span>seg<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><br>    <span class="token function">build</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> nums<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><br>    ans <span class="token operator">:=</span> <span class="token number">0</span><br>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> query <span class="token operator">:=</span> <span class="token keyword">range</span> queries <span class="token punctuation">{<!-- --></span><br>        <span class="token function">update</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> query<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> query<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>        ans <span class="token operator">=</span> <span class="token punctuation">(</span>ans <span class="token operator">+</span> tree<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_11<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1</span>_000_000_007<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> ans<br><span class="token punctuation">}</span><br></code></pre> <br><blockquote> <br> <p>同步发文于CSDN和我的<a href="https://blog.letmefly.xyz/" rel="nofollow">个人博客</a>，原创不易，转载经作者同意后请附上<a href="https://blog.letmefly.xyz/2024/11/02/LeetCode%203165.%E4%B8%8D%E5%8C%85%E5%90%AB%E7%9B%B8%E9%82%BB%E5%85%83%E7%B4%A0%E7%9A%84%E5%AD%90%E5%BA%8F%E5%88%97%E7%9A%84%E6%9C%80%E5%A4%A7%E5%92%8C/" rel="nofollow">原文链接</a>哦~</p> <br> <p>Tisfy：<a href="https://letmefly.blog.csdn.net/article/details/143452715" rel="nofollow">https://letmefly.blog.csdn.net/article/details/143452715</a></p> <br></blockquote>