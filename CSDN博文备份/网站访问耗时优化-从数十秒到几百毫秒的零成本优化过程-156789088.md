<h2><a id="____GeoDNS_1"></a>ç½‘ç«™è®¿é—®è€—æ—¶ä¼˜åŒ– - ä»æ•°åç§’åˆ°å‡ ç™¾æ¯«ç§’çš„â€œé›¶æˆæœ¬â€ä¼˜åŒ–è¿‡ç¨‹ - é˜¿é‡Œäº‘å­åŸŸGeoDNSå›½å†…å¤–åˆ†æµ</h2> <br><blockquote> <br> <ul><li>Website Latency Optimization: A Zero-Cost Journey from Tens of Seconds to Hundreds of Milliseconds</li><li>From 30 Seconds to 300 Milliseconds: Zero-Cost Website Performance Optimization</li></ul> <br></blockquote> <br><h3><a id="_6"></a>èƒŒæ™¯</h3> <br><p>ä¹‹å‰ä¸ºäº†ä¿æŠ¤æˆ‘é‚£å°å­±å¼±çš„å°æœåŠ¡å™¨çš„çœŸå®ipå…å—æ”»å‡»ï¼Œæˆ‘å°†æœåŠ¡å™¨çš„æ‰€æœ‰HTTP(s)æœåŠ¡é™åˆ¶ä¸ºä»…èƒ½é€šè¿‡åŸŸåè®¿é—®ï¼Œä¸”æŠŠåŸŸåæ‰˜ç®¡åœ¨äº†<strong>Cloudflare</strong>ä¸Šå¼€å¯äº†ä»£ç†å°äº‘æœµã€‚</p> <br><p>å°±è¿™æ ·å‡ å¹´è¿‡å»äº†ï¼Œè¶Šæ¥è¶Šè§‰å¾—ç½‘ç«™è®¿é—®æ˜¯çœŸçš„æ…¢ï¼ˆä¸ç®¡æœ‰æ²¡æœ‰ç‰¹æ®Šç½‘ç»œéƒ½å¾ˆæ…¢ï¼‰ã€‚å¹¶ä¸”æœ‰ğŸ‘‡ï¼Œæ‰€ä»¥å†³å®šä¼˜åŒ–ä¸€æ‰‹ã€‚</p> <br><blockquote> <br> <p><a href="https://www.cloudflare.com/learning/performance/more/website-performance-conversion-rates/" rel="nofollow">CloudFlare: ç½‘ç«™æ€§èƒ½å¦‚ä½•å½±å“è½¬åŒ–ç‡</a></p> <br> <p>æ²ƒå°”ç›å‘ç°ï¼Œé¡µé¢åŠ è½½æ—¶é—´æ¯å‡å°‘ 1 ç§’ï¼Œè½¬åŒ–æ•°å°±ä¼šå¢åŠ  2ï¼…â€¦</p> <br></blockquote> <br><p><strong>æœ€ç»ˆï¼Œä»æ¯æ¬¡è®¿é—®â€œå¿«åˆ™å¥½å‡ ç§’å¹³å‡åæ¥ç§’æ…¢åˆ™å¥½å‡ åç§’â€åˆ°â€œç²—ç•¥ç»Ÿè®¡å…¨çƒè®¿é—®å¹³å‡å‡ ç™¾æ¯«ç§’â€çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå¹¶ä¸”å‡ ä¹æ²¡æœ‰ä¿®æ”¹ä»£ç ã€‚</strong>ï¼ˆç†æƒ³çŠ¶æ€å¹³å‡å‡ åæ¯«ç§’ï¼‰</p> <br><h3><a id="_18"></a>è€—æ—¶åŸå› åˆ†æ</h3> <br><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ­£å¸¸æƒ…å†µä¸‹é”…å†…å¤–çš„ç½‘ç»œä¼ è¾“éƒ½è¦ä¸å¯é¿å…åœ°ç»è¿‡TheGreatWallï¼Œæ¥ä¿éšœå›½æ°‘çš„ç½‘ç»œä¿¡æ¯å®‰å…¨ã€‚</p> <br><p>ä¸ºä»€ä¹ˆCDNæœåŠ¡å™¨éå¸ƒå…¨çƒçš„èµ›åšè©è¨Cloudflareåœ¨é”…å†…ä¼šå˜æˆå‡é€ŸCDNå‘¢ï¼Ÿå¤§æ¦‚ç‡æ˜¯ç»è¿‡äº†ä¸Šé¢çš„å®ƒâ†‘ã€‚</p> <br><p>ä¸ºäº†å®é”¤ä¸€ä¸‹ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤</p> <br><pre><code class="prism language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">curl</span> -o /dev/null -s -w <span class="token string">"%{time_connect} %{time_starttransfer} %{time_total}<span class="token entity" title="\n">\n</span>"</span> https://nextcloud.letmefly.xyz<span class="token punctuation">;</span> <span class="token keyword">done</span><br></code></pre> <br><p>å¾—åˆ°ç»“æœ20æ¬¡è¯·æ±‚çš„è¿æ¥è€—æ—¶ã€é¦–å­—èŠ‚è¿”å›è€—æ—¶ã€æ€»è€—æ—¶ï¼š</p> <br><pre><code>0.726453 4.388203 4.388237<br>1.346249 7.263477 7.263509<br>2.228933 10.111719 10.111752<br>2.660601 9.483325 9.483393<br>1.028620 3.424524 3.424555<br>0.795678 3.197058 3.197130<br>1.114911 3.688075 3.688237<br>0.697664 5.477339 5.477411<br>0.821841 26.322082 26.322112<br>0.916166 3.698248 3.698305<br>1.404712 4.999771 4.999802<br>0.772932 3.323453 3.323484<br>2.204168 5.768386 5.768476<br>1.264734 3.941814 3.941846<br>0.788361 6.344063 6.344097<br>3.425116 0.000000 72.185861<br>2.303902 9.694897 9.695196<br>0.919144 6.506560 6.506636<br>0.778423 4.272682 4.272722<br>0.527677 8.258768 8.258819<br></code></pre> <br><p>ç¬¬äºŒåˆ—å’Œç¬¬ä¸‰åˆ—å‡ ä¹ç›¸åŒï¼Œè¯´æ˜æœåŠ¡ç«¯æ•°æ®å¤„ç†éå¸¸è¿…é€Ÿï¼Œè€—æ—¶å‡ ä¹ä¸º0ï¼Œè€Œæ•´ä¸ªç½‘ç»œå¼€é”€å‡ ä¹å‡è€—æ—¶åœ¨ç½‘ç»œä¼ è¾“ä¸Šï¼ˆæœåŠ¡å™¨â€“cloudflareâ€“æœåŠ¡å™¨ï¼‰ï¼Œç„¶åå°±æœ‰äº†ç¬¬ä¸‰åˆ—è¿™ç¾éš¾çº§åˆ«çš„è€—æ—¶ã€‚</p> <br><h3><a id="GeoDNS_57"></a>Geo-DNSåˆ†æµ</h3> <br><p>æ—¢ç„¶çŸ¥é“äº†ç½‘ç»œå¼€é”€çš„å·¨å¤§å¤´ä¸»è¦æ¥è‡ªHTTPçš„è·¨å¢ƒè¡Œä¸ºï¼Œæ‰€ä»¥è®©å›½å†…ç”¨æˆ·è®¿é—®æˆ‘çš„å›½å†…æœåŠ¡å™¨ï¼Œå›½å¤–ç”¨æˆ·è®¿é—®å›½å¤–Github Pagesï¼ˆçº¯é™æ€é¡µé¢ï¼‰ä¸å°±å¥½äº†ä¹ˆï¼Œå…·ä½“è®¿é—®çš„å“ªä¸ªIPå¯¹ç”¨æˆ·æ˜¯æ— æ„Ÿçš„ï¼Œä¸”ä¸€ä¸ªåŸŸåå°±èƒ½å®ç°ã€‚</p> <br><p>ç”±äºä¸»åŸŸå<a href="https://letmefly.xyz" rel="nofollow"><code>letmefly.xyz</code></a>æ‰˜ç®¡åœ¨cloudflareä¸Šä¸”ä»æœ‰å…¶ç”¨ï¼Œè€Œcloudflareçš„GeoDNSæˆæœ¬å¤§çº¦æ¯ä¸ªæœˆå‡ åç¾å…ƒ(æœªè¯¦ç»†ç»Ÿè®¡ç¡®è®¤)ï¼Œæ¯”å°æœåŠ¡å™¨è´µå¾ˆå¤šï¼Œæ‰€ä»¥å†³å®šå°†<code>blog.letmefly.xyz</code>å­åŸŸæ‰˜ç®¡åˆ°å…è´¹çš„é˜¿é‡Œäº‘DNSæœåŠ¡ä¸Šã€‚ï¼ˆè…¾è®¯äº‘DNSä¹Ÿæœ‰ç±»ä¼¼å…è´¹æœåŠ¡ï¼Œä½†ç”±äºè¯¥åŸŸåè´­ä¹°è‡ªé˜¿é‡Œäº‘ï¼Œæ‰€ä»¥é€‰æ‹©äº†æ‰˜ç®¡åœ¨é˜¿é‡Œäº‘ä¸Šï¼‰</p> <br><h4><a id="blogletmeflyxyz_63"></a>blog.letmefly.xyzå­åŸŸæ‰˜ç®¡</h4> <br><p>åœ¨cloudflareæ§åˆ¶é¢æ¿ä¿®æ”¹<a href="https://blog.letmefly.xyz" rel="nofollow">blog.letmefly.xyz</a>çš„DNSè®°å½•ä¸º<code>NS</code>ï¼Œå€¼ä¸º<code>ns1.alidns.com</code>ï¼Œå†æ–°å»ºä¸€ä¸ª<code>NS</code>å€¼ä¸º<code>ns2.alidns.com</code>ã€‚</p> <br><p>åœ¨é˜¿é‡Œäº‘DNSè§£ææ§åˆ¶å°æ·»åŠ åŸŸå<code>blog.letmefly.xyz</code>ï¼Œè¿›è¡ŒTXTæ ¡éªŒï¼ˆåœ¨cloudflareæ·»åŠ <code>alidnscheck.letmefly.xyz</code>çš„<code>TXT</code>ç±»å‹çš„è®°å½•ï¼‰ã€‚</p> <br><p>æ·»åŠ è®°å½•ï¼š</p> <br><table><thead><tr><th>ä¸»æœºè®°å½•</th><th>è®°å½•ç±»å‹</th><th>è§£æè¯·æ±‚æ¥æº</th><th>è®°å½•å€¼</th></tr></thead><tbody><tr><td>@</td><td>AAAAA</td><td>å¢ƒå¤–</td><td>2606:50c:0:8003::153</td></tr><tr><td>@</td><td>AAAAA</td><td>å¢ƒå¤–</td><td>2606:50c:0:8002::153</td></tr><tr><td>@</td><td>AAAAA</td><td>å¢ƒå¤–</td><td>2606:50c:0:8001::153</td></tr><tr><td>@</td><td>AAAAA</td><td>å¢ƒå¤–</td><td>2606:50c:0:8000::153</td></tr><tr><td>@</td><td>A</td><td>å¢ƒå¤–</td><td>185.199.111.153</td></tr><tr><td>@</td><td>A</td><td>å¢ƒå¤–</td><td>185.199.110.153</td></tr><tr><td>@</td><td>A</td><td>å¢ƒå¤–</td><td>185.199.109.153</td></tr><tr><td>@</td><td>A</td><td>å¢ƒå¤–</td><td>185.199.108.153</td></tr><tr><td>@</td><td>A</td><td>ä¸­å›½åœ°åŒº</td><td>39.105.42.186</td></tr></tbody></table><br><p>å‰é¢8ä¸ªæ˜¯Githubï¼ˆ<a href="https://docs.github.com/zh/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site" rel="nofollow">å®˜æ–¹æ–‡æ¡£</a>ï¼‰ï¼Œæœ€åä¸€ä¸ªæ˜¯æˆ‘çš„æœåŠ¡å™¨ã€‚</p> <br><p>æ˜¯çš„ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œå®Œäº‹äº†ï¼</p> <br><h3><a id="Github_87"></a>æœåŠ¡å™¨æ‹‰å–Githubè„šæœ¬</h3> <br><p>æœåŠ¡å™¨ä¸Šè®¾è®¡ä¸ºï¼šå¯åŠ¨ä¸€ä¸ªwebhook listenerï¼Œå½“githubä»“åº“websiteåˆ†æ”¯æ›´æ–°æ—¶å‘æœåŠ¡å™¨å‘é€é€šçŸ¥ï¼ŒæœåŠ¡å™¨æ‹‰å–æœ€æ–°æºç ï¼Œå¹¶åŸå­åŒ–é“¾æ¥æ•´ä¸ªç›®å½•åˆ°nginxé…ç½®çš„ç›®å½•ã€‚</p> <br><pre><code class="prism language-go"><span class="token comment">/*<br> * @LastEditTime: 2026-01-08 18:54:37<br> */</span><br><span class="token keyword">package</span> main<br><br><span class="token keyword">import</span> <span class="token punctuation">(</span><br>    <span class="token string">"crypto/hmac"</span><br>    <span class="token string">"crypto/rand"</span><br>    <span class="token string">"crypto/sha256"</span><br>    <span class="token string">"encoding/hex"</span><br>    <span class="token string">"encoding/json"</span><br>    <span class="token string">"io"</span><br>    <span class="token string">"log"</span><br>    <span class="token string">"math/big"</span><br>    <span class="token string">"net/http"</span><br>    <span class="token string">"os"</span><br>    <span class="token string">"os/exec"</span><br>    <span class="token string">"path/filepath"</span><br>    <span class="token string">"regexp"</span><br>    <span class="token string">"strings"</span><br>    <span class="token string">"time"</span><br><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> <span class="token punctuation">(</span><br>    listenAddr <span class="token operator">=</span> <span class="token string">"127.0.0.1:1209"</span><br>    secretFile <span class="token operator">=</span> <span class="token string">".secret"</span><br><span class="token punctuation">)</span><br><br><span class="token keyword">type</span> RepoConfig <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span><br>    BaseDir   <span class="token builtin">string</span><br>    RepoURL   <span class="token builtin">string</span><br>    TargetRef <span class="token builtin">string</span><br>    Branch    <span class="token builtin">string</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">var</span> repos <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>RepoConfig<span class="token punctuation">{<!-- --></span><br>    <span class="token string">"/hook/github/leetcode"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><br>        BaseDir<span class="token punctuation">:</span>   <span class="token string">"/www/blog"</span><span class="token punctuation">,</span><br>        RepoURL<span class="token punctuation">:</span>   <span class="token string">"git@github.com:LetMeFly666/LeetCode.git"</span><span class="token punctuation">,</span><br>        TargetRef<span class="token punctuation">:</span> <span class="token string">"refs/heads/website"</span><span class="token punctuation">,</span><br>        Branch<span class="token punctuation">:</span>    <span class="token string">"website"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token string">"/hook/github/various"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><br>        BaseDir<span class="token punctuation">:</span>   <span class="token string">"/www/various"</span><span class="token punctuation">,</span><br>        RepoURL<span class="token punctuation">:</span>   <span class="token string">"git@github.com:LetMeFly666/various.git"</span><span class="token punctuation">,</span><br>        TargetRef<span class="token punctuation">:</span> <span class="token string">"refs/heads/master"</span><span class="token punctuation">,</span><br>        Branch<span class="token punctuation">:</span>    <span class="token string">"master"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> PushEvent <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span><br>    Ref <span class="token builtin">string</span> <span class="token string">`json:"ref"`</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">var</span> secret <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><br><br><span class="token keyword">func</span> <span class="token function">loadSecret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    data<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>secretFile<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span><br>        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">"read secret failed:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    secret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">verifySignature</span><span class="token punctuation">(</span>body <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> signature <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{<!-- --></span><br>    mac <span class="token operator">:=</span> hmac<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>sha256<span class="token punctuation">.</span>New<span class="token punctuation">,</span> secret<span class="token punctuation">)</span><br>    mac<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><br>    expected <span class="token operator">:=</span> <span class="token string">"sha256="</span> <span class="token operator">+</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>mac<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token keyword">return</span> hmac<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">handler</span><span class="token punctuation">(</span>cfg RepoConfig<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{<!-- --></span><br>    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>        body<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><br><br>        sig <span class="token operator">:=</span> r<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"X-Hub-Signature-256"</span><span class="token punctuation">)</span><br>        <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">verifySignature</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> sig<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"invalid signature"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusForbidden<span class="token punctuation">)</span><br>            <span class="token keyword">return</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token keyword">var</span> event PushEvent<br>        <span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token operator">&</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span><br>            http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"bad payload"</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span><br>            <span class="token keyword">return</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token keyword">if</span> event<span class="token punctuation">.</span>Ref <span class="token operator">!=</span> cfg<span class="token punctuation">.</span>TargetRef <span class="token punctuation">{<!-- --></span><br>            w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"ignored\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token keyword">return</span><br>        <span class="token punctuation">}</span><br><br>        w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"accepted\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><br>        <span class="token keyword">go</span> <span class="token function">deployWebsite</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">randomSuffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span><br>    n<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span>Reader<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">1_000_000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token keyword">return</span> n<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">deployWebsite</span><span class="token punctuation">(</span>cfg RepoConfig<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    ts <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"20060102_150405"</span><span class="token punctuation">)</span><br>    newDir <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>BaseDir<span class="token punctuation">,</span> <span class="token string">"website_"</span><span class="token operator">+</span>ts<span class="token operator">+</span><span class="token string">"_"</span><span class="token operator">+</span><span class="token function">randomSuffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    currentLink <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>BaseDir<span class="token punctuation">,</span> <span class="token string">"website"</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">if</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">MkdirAll</span><span class="token punctuation">(</span>newDir<span class="token punctuation">,</span> <span class="token number">0755</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span><br>        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"mkdir failed:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><br>        <span class="token keyword">return</span><br>    <span class="token punctuation">}</span><br><br>    cmd <span class="token operator">:=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><br>        <span class="token string">"git"</span><span class="token punctuation">,</span> <span class="token string">"clone"</span><span class="token punctuation">,</span><br>        <span class="token string">"-b"</span><span class="token punctuation">,</span> cfg<span class="token punctuation">.</span>Branch<span class="token punctuation">,</span><br>        <span class="token string">"--depth=1"</span><span class="token punctuation">,</span><br>        cfg<span class="token punctuation">.</span>RepoURL<span class="token punctuation">,</span><br>        newDir<span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><br>    <span class="token keyword">if</span> out<span class="token punctuation">,</span> err <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">CombinedOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span><br>        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"git clone failed:"</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span><br>    <span class="token punctuation">}</span><br><br>    cmd <span class="token operator">=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"ln"</span><span class="token punctuation">,</span> <span class="token string">"-sfn"</span><span class="token punctuation">,</span> newDir<span class="token punctuation">,</span> currentLink<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> out<span class="token punctuation">,</span> err <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">CombinedOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span><br>        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ln -sfn failed:"</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token function">cleanupOldReleases</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>BaseDir<span class="token punctuation">,</span> newDir<span class="token punctuation">)</span><br><br>    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"deploy success:"</span><span class="token punctuation">,</span> newDir<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">var</span> releaseRegexp <span class="token operator">=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">`^website_\d{8}_\d{6}_\d+$`</span><span class="token punctuation">)</span><br><br><span class="token keyword">func</span> <span class="token function">cleanupOldReleases</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> keepDir <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    entries<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadDir</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">return</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> entries <span class="token punctuation">{<!-- --></span><br>        <span class="token keyword">if</span> <span class="token operator">!</span>e<span class="token punctuation">.</span><span class="token function">IsDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">continue</span><br>        <span class="token punctuation">}</span><br>        name <span class="token operator">:=</span> e<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token keyword">if</span> <span class="token operator">!</span>releaseRegexp<span class="token punctuation">.</span><span class="token function">MatchString</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">continue</span><br>        <span class="token punctuation">}</span><br>        full <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> name<span class="token punctuation">)</span><br>        <span class="token keyword">if</span> full <span class="token operator">==</span> keepDir <span class="token punctuation">{<!-- --></span><br>            <span class="token keyword">continue</span><br>        <span class="token punctuation">}</span><br>        <span class="token boolean">_</span> <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">RemoveAll</span><span class="token punctuation">(</span>full<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><br>    <span class="token function">loadSecret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">for</span> path<span class="token punctuation">,</span> cfg <span class="token operator">:=</span> <span class="token keyword">range</span> repos <span class="token punctuation">{<!-- --></span><br>        http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"listening on"</span><span class="token punctuation">,</span> listenAddr<span class="token punctuation">)</span><br>    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span>listenAddr<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br></code></pre> <br><p>åœ¨githubå¯¹åº”ä»“åº“â€“settingsâ€“webhookâ€“æ–°å¢â€“è¾“å…¥å¯†é’¥ï¼ˆéšæœºå­—ç¬¦ä¸²ï¼Œå¯ç”±<code>openssl rand -hex 32</code>å‘½ä»¤ç”Ÿæˆï¼‰â€“ç±»å‹é€‰æ‹©jsonâ€“ä¸éœ€è¦é¢å¤–æ•°æ®ã€‚</p> <br><p>æœ¬åœ°åœ¨ç¨‹åºæ‰§è¡Œç›®å½•åˆ›å»ºä¸€ä¸ª<code>.secret</code>æ–‡ä»¶å¹¶å†™å…¥ç”Ÿæˆçš„å¯†é’¥ï¼Œåå°è¿è¡Œè¯¥ç›‘å¬è„šæœ¬å³å¯ã€‚ï¼ˆä¸Šé¢æ–¹æ³•ä¿ºè®¾è®¡çš„ï¼Œå˜»å˜»ï¼‰</p> <br><h3><a id="_268"></a>ç»“æœ</h3> <br><h4><a id="_270"></a>å›½å†…</h4> <br><p>åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ<code>for i in {1..20}; do curl -o /dev/null -s -w "%{time_connect} %{time_starttransfer} %{time_total}\n" https://nextcloud.letmefly.xyz; done</code>ï¼Œç»“æœï¼š</p> <br><pre><code>0.007227 0.079349 0.079377<br>0.005464 0.081657 0.081687<br>0.005054 0.074545 0.074576<br>0.456098 0.524839 0.524884<br>0.469940 0.541030 0.541060<br>0.006224 0.081239 0.081265<br>0.005814 0.080448 0.080479<br>0.006077 0.077889 0.077928<br>0.005238 0.079339 0.079365<br>0.004949 0.076759 0.076791<br>0.005104 0.079881 0.079907<br>0.005950 0.082108 0.082139<br>0.006417 0.082243 0.082295<br>0.005584 0.081760 0.081788<br>0.455143 0.551400 0.551427<br>0.005367 0.084855 0.084886<br>0.455233 0.535178 0.535216<br>0.005935 0.084052 0.084079<br>0.004623 0.101036 0.101117<br>0.005021 0.082109 0.082138<br></code></pre> <br><p>è¿™ä¸ªåº”è¯¥æ˜¯ç›´æ¥èµ°Localhostäº†?ã€‚</p> <br><p>å¼ºåˆ¶èµ°å…¬ç½‘ï¼š</p> <br><pre><code class="prism language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">curl</span> -o /dev/null -s --resolve nextcloud.letmefly.xyz:443:39.105.42.186 -w <span class="token string">"%{time_connect} %{time_starttransfer} %{time_total}<span class="token entity" title="\n">\n</span>"</span> https://nextcloud.letmefly.xyz<span class="token punctuation">;</span> <span class="token keyword">done</span><br>tcpdump -i eth0 <span class="token function">host</span> <span class="token number">39.105</span>.42.186 and port <span class="token number">443</span><br></code></pre> <br><p>å¹¶å¦å¤–å¯åŠ¨ä¸€ä¸ªçª—å£æŠ“åŒ…ï¼š</p> <br><pre><code class="prism language-bash">tcpdump -i eth0 <span class="token function">host</span> <span class="token number">39.105</span>.42.186 and port <span class="token number">443</span><br></code></pre> <br><p>å¯ä»¥çœ‹åˆ°ï¼š</p> <br><pre><code class="prism language-bash">tisfy.https â†’ <span class="token number">39.105</span>.42.186.38608<br><span class="token number">39.105</span>.42.186.38608 â†’ tisfy.https<br></code></pre> <br><p>è¯´æ˜èµ°äº†å…¬ç½‘ã€‚</p> <br><p>è¯¶ï¼Œè¿˜æ˜¯å¾ˆå¿«ã€‚</p> <br><p>ç›´æ¥ä½¿ç”¨ä¸€å°æ‰‹ä¸­çš„è®¾å¤‡æµ‹è¯•ï¼Œä¸åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•äº†</p> <br><pre><code>0.030351 0.122197 0.122252<br>0.012166 0.094488 0.094556<br>0.013372 0.118933 0.119127<br>0.015152 0.121100 0.121195<br>0.012782 0.093575 0.093694<br>0.011981 0.090665 0.090767<br>0.012699 0.092128 0.092318<br>0.014691 0.167777 0.167850<br>0.013061 0.207214 0.207498<br>0.013980 0.273402 0.273721<br>0.014736 0.186312 0.186655<br>0.015405 0.170255 0.170587<br>0.075688 0.263535 0.263765<br>0.014979 0.154608 0.154884<br>0.014043 0.276435 0.276624<br>0.014873 0.180383 0.180700<br>0.014767 0.260764 0.260981<br>0.015220 0.166855 0.167178<br>0.013348 0.176619 0.176928<br>0.014471 0.171316 0.171636<br></code></pre> <br><p>è¿™ä¸‹æ²¡åŠæ³•äº†ï¼Œèµ°çš„wifiè¿çš„æœåŠ¡å™¨ï¼Œè¿˜æ˜¯å¾ˆå¿«ã€‚</p> <br><h4><a id="_350"></a>å›½å¤–</h4> <br><p>ç”±äºæ²¡æœ‰åœ¨å›½å¤–çš„è®¾å¤‡ï¼Œæ‰€ä»¥ä¸´æ—¶å†™äº†ä¸ªgithub actionæµ‹ä¸‹</p> <br><pre><code class="prism language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Test blog.letmefly.xyz latency <span class="token punctuation">-</span> å¢ƒå¤–è®¿é—®å»¶è¿Ÿæµ‹è¯•<br><br><span class="token key atrule">on</span><span class="token punctuation">:</span><br>   <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span><br><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">latency-test</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br><br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Print debug info<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>          echo "==== Debug Info ===="<br>          echo "Runner hostname: $(hostname)"<br>          echo "GitHub runner public IP:"<br>          curl -s https://ifconfig.me || echo "Failed to get public IP"<br>          echo "==================="</span><br><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Resolve target IP<br>        <span class="token key atrule">id</span><span class="token punctuation">:</span> resolve<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>          TARGET=blog.letmefly.xyz<br>          IP=$(dig +short $TARGET | head -n1)<br>          echo "Target: $TARGET"<br>          echo "Resolved IP: $IP"<br>          echo "IP=$IP" >> $GITHUB_OUTPUT</span><br><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Test latency 20 times<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>          TARGET=blog.letmefly.xyz<br>          IP=${<!-- -->{ steps.resolve.outputs.IP }}<br>          echo "time_connect time_starttransfer time_total"</span><br>          <br>          <span class="token comment"># åˆå§‹åŒ–ç´¯åŠ å™¨</span><br>          sum_connect=0<br>          sum_starttransfer=0<br>          sum_total=0<br>          <br>          for i in <span class="token punctuation">{<!-- --></span>1..20<span class="token punctuation">}</span>; do<br>            <span class="token comment"># å–ä¸‰ä¸ªæ—¶é—´</span><br>            read connect starttransfer total <<< $(curl <span class="token punctuation">-</span>o /dev/null <span class="token punctuation">-</span>s \<br>                 <span class="token punctuation">-</span><span class="token punctuation">-</span>resolve $TARGET<span class="token punctuation">:</span>443<span class="token punctuation">:</span>$IP \<br>                 <span class="token punctuation">-</span>w "%<span class="token punctuation">{<!-- --></span>time_connect<span class="token punctuation">}</span> %<span class="token punctuation">{<!-- --></span>time_starttransfer<span class="token punctuation">}</span> %<span class="token punctuation">{<!-- --></span>time_total<span class="token punctuation">}</span>" \<br>                 https<span class="token punctuation">:</span>//$TARGET)<br>                 <br>            <span class="token comment"># ç´¯åŠ </span><br>            sum_connect=$(echo "$sum_connect + $connect" <span class="token punctuation">|</span> bc)<br>            sum_starttransfer=$(echo "$sum_starttransfer + $starttransfer" <span class="token punctuation">|</span> bc)<br>            sum_total=$(echo "$sum_total + $total" <span class="token punctuation">|</span> bc)<br>            <br>            <span class="token comment"># è¾“å‡º</span><br>            echo "$connect $starttransfer $total"<br>          done<br>          <br>          <span class="token comment"># è®¡ç®—å¹³å‡</span><br>          avg_connect=$(echo "scale=4; $sum_connect/20" <span class="token punctuation">|</span> bc)<br>          avg_starttransfer=$(echo "scale=4; $sum_starttransfer/20" <span class="token punctuation">|</span> bc)<br>          avg_total=$(echo "scale=4; $sum_total/20" <span class="token punctuation">|</span> bc)<br>          <br>          echo "AVERAGE $avg_connect $avg_starttransfer $avg_total"<br></code></pre> <br><p>Githubä¸Šæµ‹Github Pagesä¼¼ä¹æœ‰ç‚¹å°ä½œå¼Š(bushi)ï¼Œä½†æ²¡åŠæ³•äº†ã€‚</p> <br><pre><code>Runner hostname: runnervmi13qx<br>GitHub runner public IP:<br>172.212.165.69<br><br>Target: blog.letmefly.xyz<br>Resolved IP: 185.199.110.153<br><br>time_connect time_starttransfer time_total<br>0.013474 0.096664 0.101290<br>0.011528 0.091032 0.095257<br>0.012259 0.053301 0.058006<br>0.011481 0.049095 0.053492<br>0.009328 0.046950 0.050534<br>0.008894 0.042994 0.047134<br>0.013758 0.056136 0.061113<br>0.011655 0.059527 0.063557<br>0.014356 0.054987 0.060360<br>0.011576 0.049023 0.053552<br>0.011710 0.049211 0.053547<br>0.011660 0.048587 0.052985<br>0.011670 0.057137 0.061753<br>0.008896 0.045748 0.049883<br>0.014311 0.053899 0.059477<br>0.013615 0.053529 0.059438<br>0.011551 0.049421 0.053476<br>0.013896 0.060151 0.065085<br>0.014129 0.090222 0.095611<br>0.013318 0.052731 0.057438<br>AVERAGE .0121 .0580 .0626<br></code></pre> <br><h4><a id="_451"></a>å›½å†…å¤–</h4> <br><p>ä¹Ÿå¯ä»¥åœ¨<a href="blog.letmefly.xyz" rel="nofollow">itdog</a>ä¸Šæµ‹è¯•å›½å†…å¤–è®¿é—®ï¼Œç½‘ç»œè´¨é‡åŠå…¶ä¸ç¡®å®šå› ç´ ä¼šå¢å¤šï¼Œè€—æ—¶ç»“æœç¨é«˜ã€‚</p> <br><p>ä½†HTTPè¯·æ±‚åªè¦ä¸ç»è¿‡å¢™å¢™ï¼Œå¹³å‡è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ã€‚</p> <br><p>å›½å†…å¤–è®¿é—®è‰¯æ°‘ç½‘ç«™çš„DNSæœåŠ¡ï¼Œä¹Ÿå¾ˆå¿«ï¼ˆå¹¶ä¸”è¿˜æœ‰ç¼“å­˜ï¼‰ï¼›å›½å¤–è®¿é—®Github(Anycast)æœ¬æ¥å°±å¾ˆå¿«ã€‚</p> <br><h3><a id="End_459"></a>End</h3> <br><center><br> <font size="6px" face="Ink Free">The Real End, Thanks!</font><br></center> <br><blockquote> <br> <p>åŒæ­¥å‘æ–‡äº<a href="https://letmefly.blog.csdn.net/article/details/156789088" rel="nofollow">CSDN</a>å’Œæˆ‘çš„<a href="https://blog.letmefly.xyz/" rel="nofollow">ä¸ªäººåšå®¢</a>ï¼ŒåŸåˆ›ä¸æ˜“ï¼Œè½¬è½½ç»ä½œè€…åŒæ„åè¯·é™„ä¸Š<a href="https://blog.letmefly.xyz/2026/01/10/Other-Website-ZeroCostLatencyOptimization/" rel="nofollow">åŸæ–‡é“¾æ¥</a>å“¦~</p> <br> <p>åƒç¯‡æºç é¢˜è§£<a href="https://github.com/LetMeFly666/LeetCode">å·²å¼€æº</a></p> <br></blockquote>